
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <title>Interactive COBOL Control Flow</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: white;
        }
        .node circle {
            stroke-width: 2px;
            cursor: pointer;
            transition: fill 0.3s, stroke 0.3s;
        }
        .node text {
            font: 14px sans-serif;
            fill: #000;
            pointer-events: none;
        }
        .link {
            fill: none;
            stroke: #d2b48c; /* Light brown lines */
            stroke-width: 1.5px;
            marker-end: url(#arrow); /* Add directional arrows */
        }
    </style>
</head>
<body>
    <script>
        const data = {
  "name": "root",
  "text": "      *****************************************************************         \n      * Program:     COCRDLIC.CBL                                     *         \n      * Layer:       Business logic                                   *         \n      * Function:    List Credit Cards                                          \n      *              a) All cards if no context passed and admin user           \n      *              b) Only the ones associated with ACCT in COMMAREA          \n      *                 if user is not admin                                    \n      ******************************************************************\n      * Copyright Amazon.com, Inc. or its affiliates.                   \n      * All Rights Reserved.                                            \n      *                                                                 \n      * Licensed under the Apache License, Version 2.0 (the \"License\"). \n      * You may not use this file except in compliance with the License.\n      * You may obtain a copy of the License at                         \n      *                                                                 \n      *    http://www.apache.org/licenses/LICENSE-2.0                   \n      *                                                                 \n      * Unless required by applicable law or agreed to in writing,      \n      * software distributed under the License is distributed on an     \n      * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,    \n      * either express or implied. See the License for the specific     \n      * language governing permissions and limitations under the License\n      ******************************************************************        \n                                                                                \n       IDENTIFICATION DIVISION.                                                 \n       PROGRAM-ID.                                                              \n           COCRDLIC.                                                            \n       DATE-WRITTEN.                                                            \n           April 2022.                                                          \n       DATE-COMPILED.                                                           \n           Today.                                                               \n                                                                                \n       ENVIRONMENT DIVISION.                                                    \n       INPUT-OUTPUT SECTION.                                                    \n                                                                                \n       DATA DIVISION.                                                           \n                                                                                \n       WORKING-STORAGE SECTION.                                                 \n                                                                                \n                                                                                \n       01  WS-MISC-STORAGE.                                                     \n      ******************************************************************        \n      * General CICS related                                                    \n      ******************************************************************        \n                                                                                \n         05 WS-CICS-PROCESSNG-VARS.                                             \n            07 WS-RESP-CD                          PIC S9(09) COMP              \n                                                   VALUE ZEROS.                 \n            07 WS-REAS-CD                          PIC S9(09) COMP              \n                                                   VALUE ZEROS.                 \n            07 WS-TRANID                           PIC X(4)                     \n                                                   VALUE SPACES.                \n      ******************************************************************        \n      * Input edits                                                             \n      ******************************************************************        \n         05 WS-INPUT-FLAG                          PIC X(1).                    \n           88  INPUT-OK                            VALUES '0'                   \n                                                          ' '                   \n                                                   LOW-VALUES.                  \n           88  INPUT-ERROR                         VALUE '1'.                   \n         05  WS-EDIT-ACCT-FLAG                     PIC X(1).                    \n           88  FLG-ACCTFILTER-NOT-OK               VALUE '0'.                   \n           88  FLG-ACCTFILTER-ISVALID             VALUE '1'.                    \n           88  FLG-ACCTFILTER-BLANK                VALUE ' '.                   \n         05  WS-EDIT-CARD-FLAG                     PIC X(1).                    \n           88  FLG-CARDFILTER-NOT-OK               VALUE '0'.                   \n           88  FLG-CARDFILTER-ISVALID             VALUE '1'.                    \n           88  FLG-CARDFILTER-BLANK                VALUE ' '.                   \n         05 WS-EDIT-SELECT-COUNTER                PIC S9(04)                    \n                                                  USAGE COMP-3                  \n                                                  VALUE 0.                      \n         05 WS-EDIT-SELECT-FLAGS                  PIC X(7)                      \n                                                  VALUE LOW-VALUES.             \n         05 WS-EDIT-SELECT-ARRAY REDEFINES  WS-EDIT-SELECT-FLAGS.               \n            10 WS-EDIT-SELECT                      PIC X(1)                     \n                                                  OCCURS 7 TIMES.               \n               88 SELECT-OK                        VALUES 'S', 'U'.             \n               88 VIEW-REQUESTED-ON                VALUE 'S'.                   \n               88 UPDATE-REQUESTED-ON              VALUE 'U'.                   \n               88 SELECT-BLANK                     VALUES                       \n                                                   ' ',                         \n                                                   LOW-VALUES.                  \n         05 WS-EDIT-SELECT-ERROR-FLAGS             PIC X(7).                    \n         05 WS-EDIT-SELECT-ERROR-FLAGX     REDEFINES                            \n            WS-EDIT-SELECT-ERROR-FLAGS.                                         \n            10 WS-EDIT-SELECT-ERRORS OCCURS 7 TIMES.                            \n               20 WS-ROW-CRDSELECT-ERROR          PIC X(1).                     \n                  88 WS-ROW-SELECT-ERROR          VALUE '1'.                    \n         05 WS-SUBSCRIPT-VARS.                                                  \n            10 I                                  PIC S9(4) COMP                \n                                                  VALUE 0.                      \n            10 I-SELECTED                         PIC S9(4) COMP                \n                                                  VALUE 0.                      \n               88 DETAIL-WAS-REQUESTED            VALUES 1 THRU 7.              \n      ******************************************************************        \n      * Output edits                                                            \n      ******************************************************************        \n         05 CICS-OUTPUT-EDIT-VARS.                                              \n           10  CARD-ACCT-ID-X                      PIC X(11).                   \n           10  CARD-ACCT-ID-N REDEFINES CARD-ACCT-ID-X                          \n                                                   PIC 9(11).                   \n           10  CARD-CVV-CD-X                       PIC X(03).                   \n           10  CARD-CVV-CD-N REDEFINES  CARD-CVV-CD-X                           \n                                                   PIC 9(03).                   \n           10  FLG-PROTECT-SELECT-ROWS             PIC X(1).                    \n           88  FLG-PROTECT-SELECT-ROWS-NO          VALUE '0'.                   \n           88  FLG-PROTECT-SELECT-ROWS-YES         VALUE '1'.                   \n      ******************************************************************        \n      * Output Message Construction                                             \n      ******************************************************************        \n         05  WS-LONG-MSG                           PIC X(500).                  \n         05  WS-INFO-MSG                           PIC X(45).                   \n           88  WS-NO-INFO-MESSAGE                 VALUES                        \n                                                  SPACES LOW-VALUES.            \n           88  WS-INFORM-REC-ACTIONS          VALUE                             \n               'TYPE S FOR DETAIL, U TO UPDATE ANY RECORD'.                     \n         05  WS-ERROR-MSG                         PIC X(75).                    \n           88  WS-ERROR-MSG-OFF                   VALUE SPACES.                 \n           88  WS-EXIT-MESSAGE                     VALUE                        \n               'PF03 PRESSED.EXITING'.                                          \n           88  WS-NO-RECORDS-FOUND                 VALUE                        \n               'NO RECORDS FOUND FOR THIS SEARCH CONDITION.'.                   \n           88  WS-MORE-THAN-1-ACTION              VALUE                         \n               'PLEASE SELECT ONLY ONE RECORD TO VIEW OR UPDATE'.               \n           88  WS-INVALID-ACTION-CODE              VALUE                        \n               'INVALID ACTION CODE'.                                           \n         05  WS-PFK-FLAG                           PIC X(1).                    \n           88  PFK-VALID                           VALUE '0'.                   \n           88  PFK-INVALID                         VALUE '1'.                   \n         05  WS-CONTEXT-FLAG                       PIC X(1).                    \n           88  WS-CONTEXT-FRESH-START              VALUE '0'.                   \n           88  WS-CONTEXT-FRESH-START-NO           VALUE '1'.                   \n      ******************************************************************        \n      * File and data Handling                                                  \n      ******************************************************************        \n         05 WS-FILE-HANDLING-VARS.                                              \n            10  WS-CARD-RID.                                                    \n                20  WS-CARD-RID-CARDNUM            PIC X(16).                   \n                20  WS-CARD-RID-ACCT-ID            PIC 9(11).                   \n                20  WS-CARD-RID-ACCT-ID-X          REDEFINES                    \n                    WS-CARD-RID-ACCT-ID            PIC X(11).                   \n                                                                                \n                                                                                \n                                                                                \n         05  WS-SCRN-COUNTER               PIC S9(4) COMP VALUE 0.              \n                                                                                \n         05  WS-FILTER-RECORD-FLAG                 PIC X(1).                    \n           88  WS-EXCLUDE-THIS-RECORD               VALUE '0'.                  \n           88  WS-DONOT-EXCLUDE-THIS-RECORD         VALUE '1'.                  \n         05  WS-RECORDS-TO-PROCESS-FLAG            PIC X(1).                    \n           88  READ-LOOP-EXIT                      VALUE '0'.                   \n           88  MORE-RECORDS-TO-READ                VALUE '1'.                   \n         05  WS-FILE-ERROR-MESSAGE.                                             \n           10  FILLER                              PIC X(12)                    \n                                                   VALUE 'File Error:'.         \n           10  ERROR-OPNAME                        PIC X(8)                     \n                                                   VALUE SPACES.                \n           10  FILLER                              PIC X(4)                     \n                                                   VALUE ' on '.                \n           10  ERROR-FILE                          PIC X(9)                     \n                                                   VALUE SPACES.                \n           10  FILLER                              PIC X(15)                    \n                                                   VALUE                        \n                                                   ' returned RESP '.           \n           10  ERROR-RESP                          PIC X(10)                    \n                                                   VALUE SPACES.                \n           10  FILLER                              PIC X(7)                     \n                                                   VALUE ',RESP2 '.             \n           10  ERROR-RESP2                         PIC X(10)                    \n                                                   VALUE SPACES.                \n          10  FILLER                               PIC X(5).                    \n                                                                                \n      ******************************************************************\n      * Literals and Constants                                                  \n      ******************************************************************        \n       01 WS-CONSTANTS.                                                         \n         05  WS-MAX-SCREEN-LINES                    PIC S9(4) COMP              \n                                                    VALUE 7.                    \n         05  LIT-THISPGM                            PIC X(8)                    \n             VALUE 'COCRDLIC'.                                                  \n         05  LIT-THISTRANID                         PIC X(4)                    \n             VALUE 'CCLI'.                                                      \n         05  LIT-THISMAPSET                         PIC X(7)                    \n             VALUE 'COCRDLI'.                                                   \n         05  LIT-THISMAP                            PIC X(7)                    \n             VALUE 'CCRDLIA'.                                                   \n         05  LIT-MENUPGM                            PIC X(8)                    \n             VALUE 'COMEN01C'.                                                  \n         05  LIT-MENUTRANID                         PIC X(4)                    \n             VALUE 'CM00'.                                                      \n         05  LIT-MENUMAPSET                         PIC X(7)                    \n             VALUE 'COMEN01'.                                                   \n         05  LIT-MENUMAP                            PIC X(7)                    \n             VALUE 'COMEN1A'.                                                   \n         05  LIT-CARDDTLPGM                         PIC X(8)                    \n             VALUE 'COCRDSLC'.                                                  \n         05  LIT-CARDDTLTRANID                      PIC X(4)                    \n             VALUE 'CCDL'.                                                      \n         05  LIT-CARDDTLMAPSET                      PIC X(7)                    \n             VALUE 'COCRDSL'.                                                   \n         05  LIT-CARDDTLMAP                         PIC X(7)                    \n             VALUE 'CCRDSLA'.                                                   \n         05  LIT-CARDUPDPGM                         PIC X(8)                    \n             VALUE 'COCRDUPC'.                                                  \n         05  LIT-CARDUPDTRANID                      PIC X(4)                    \n             VALUE 'CCUP'.                                                      \n         05  LIT-CARDUPDMAPSET                      PIC X(7)                    \n             VALUE 'COCRDUP'.                                                   \n         05  LIT-CARDUPDMAP                         PIC X(7)                    \n             VALUE 'CCRDUPA'.                                                   \n                                                                                \n                                                                                \n         05  LIT-CARD-FILE                          PIC X(8)                    \n                                                   VALUE 'CARDDAT '.            \n         05  LIT-CARD-FILE-ACCT-PATH                PIC X(8)                    \n                                                                                \n                                                   VALUE 'CARDAIX '.            \n      ******************************************************************        \n      *Other common working storage Variables                                   \n      ******************************************************************        \n       COPY CVCRD01Y.                                                           \n                                                                                \n      ******************************************************************        \n      *  Commarea manipulations                                                 \n      ******************************************************************        \n      *Application Commmarea Copybook                                           \n       COPY COCOM01Y.                                                           \n                                                                                \n       01 WS-THIS-PROGCOMMAREA.                                                 \n            10 WS-CA-LAST-CARDKEY.                                              \n               15  WS-CA-LAST-CARD-NUM                PIC X(16).                \n               15  WS-CA-LAST-CARD-ACCT-ID            PIC 9(11).                \n            10 WS-CA-FIRST-CARDKEY.                                             \n               15  WS-CA-FIRST-CARD-NUM               PIC X(16).                \n               15  WS-CA-FIRST-CARD-ACCT-ID           PIC 9(11).                \n                                                                                \n            10 WS-CA-SCREEN-NUM                       PIC 9(1).                 \n               88 CA-FIRST-PAGE                          VALUE 1.               \n            10 WS-CA-LAST-PAGE-DISPLAYED              PIC 9(1).                 \n               88 CA-LAST-PAGE-SHOWN                     VALUE 0.               \n               88 CA-LAST-PAGE-NOT-SHOWN                 VALUE 9.               \n            10 WS-CA-NEXT-PAGE-IND                    PIC X(1).                 \n               88 CA-NEXT-PAGE-NOT-EXISTS             VALUE LOW-VALUES.         \n               88 CA-NEXT-PAGE-EXISTS                 VALUE 'Y'.                \n                                                                                \n            10 WS-RETURN-FLAG                        PIC X(1).                  \n           88  WS-RETURN-FLAG-OFF                  VALUE LOW-VALUES.            \n           88  WS-RETURN-FLAG-ON                   VALUE '1'.                   \n      ******************************************************************        \n      *  File Data Array         28 CHARS X 7 ROWS = 196                        \n      ******************************************************************        \n         05 WS-SCREEN-DATA.                                                     \n            10 WS-ALL-ROWS                         PIC X(196).                  \n            10 FILLER REDEFINES WS-ALL-ROWS.                                    \n               15 WS-SCREEN-ROWS OCCURS  7 TIMES.                               \n                  20 WS-EACH-ROW.                                               \n                     25 WS-EACH-CARD.                                           \n                        30 WS-ROW-ACCTNO           PIC X(11).                   \n                        30 WS-ROW-CARD-NUM         PIC X(16).                   \n                        30 WS-ROW-CARD-STATUS      PIC X(1).                    \n                                                                                \n       01  WS-COMMAREA                             PIC X(2000).                 \n                                                                                \n                                                                                \n                                                                                \n      *IBM SUPPLIED COPYBOOKS                                                   \n       COPY DFHBMSCA.                                                           \n       COPY DFHAID.                                                             \n                                                                                \n      *COMMON COPYBOOKS                                                         \n      *Screen Titles                                                            \n       COPY COTTL01Y.                                                           \n      *Credit Card Search Screen Layout                                         \n      *COPY COCRDSL.                                                            \n      *Credit Card List Screen Layout                                           \n       COPY COCRDLI.                                                            \n                                                                                \n      *Current Date                                                             \n       COPY CSDAT01Y.                                                           \n      *Common Messages                                                          \n       COPY CSMSG01Y.                                                           \n      *Abend Variables                                                          \n      *COPY CSMSG02Y.                                                           \n      *Signed on user data                                                      \n       COPY CSUSR01Y.                                                           \n                                                                                \n      *Dataset layouts                                                          \n                                                                                \n      *CARD RECORD LAYOUT                                                       \n       COPY CVACT02Y.                                                           \n                                                                                \n       LINKAGE SECTION.                                                         \n       01  DFHCOMMAREA.                                                         \n         05  FILLER                                PIC X(1)                     \n             OCCURS 1 TO 32767 TIMES DEPENDING ON EIBCALEN.                     \n                                                                                \n       PROCEDURE DIVISION.                                                      \n       0000-MAIN.                                                               \n                                                                                \n           INITIALIZE CC-WORK-AREA                                              \n                      WS-MISC-STORAGE                                           \n                      WS-COMMAREA                                               \n                                                                                \n      *****************************************************************         \n      * Store our context                                                       \n      *****************************************************************         \n           MOVE LIT-THISTRANID       TO WS-TRANID                               \n      *****************************************************************         \n      * Ensure error message is cleared                               *         \n      *****************************************************************         \n           SET WS-ERROR-MSG-OFF  TO TRUE                                        \n      *****************************************************************         \n      * Retrived passed data if  any. Initialize them if first run.             \n      *****************************************************************         \n           IF EIBCALEN = 0\n              INITIALIZE CARDDEMO-COMMAREA\n                         WS-THIS-PROGCOMMAREA \n              MOVE LIT-THISTRANID        TO CDEMO-FROM-TRANID                   \n              MOVE LIT-THISPGM           TO CDEMO-FROM-PROGRAM                  \n              SET CDEMO-USRTYP-USER      TO TRUE                                \n              SET CDEMO-PGM-ENTER        TO TRUE                                \n              MOVE LIT-THISMAP           TO CDEMO-LAST-MAP                      \n              MOVE LIT-THISMAPSET        TO CDEMO-LAST-MAPSET                   \n              SET CA-FIRST-PAGE          TO TRUE                                \n              SET CA-LAST-PAGE-NOT-SHOWN TO TRUE                                \n           ELSE\n              MOVE DFHCOMMAREA (1:LENGTH OF CARDDEMO-COMMAREA) TO               \n                                CARDDEMO-COMMAREA                               \n              MOVE DFHCOMMAREA(LENGTH OF CARDDEMO-COMMAREA + 1:                 \n                               LENGTH OF WS-THIS-PROGCOMMAREA )TO               \n                                WS-THIS-PROGCOMMAREA                            \n           END-IF                                                               \n      *****************************************************************         \n      * If coming in from menu. Lets forget the past and start afresh *         \n      *****************************************************************         \n           IF (CDEMO-PGM-ENTER                                                  \n           AND CDEMO-FROM-PROGRAM NOT EQUAL LIT-THISPGM)                        \n               INITIALIZE WS-THIS-PROGCOMMAREA\n               SET CDEMO-PGM-ENTER      TO TRUE                                 \n               MOVE LIT-THISMAP         TO CDEMO-LAST-MAP                       \n               SET CA-FIRST-PAGE        TO TRUE                                 \n               SET CA-LAST-PAGE-NOT-SHOWN TO TRUE                               \n           END-IF \n                                                                                \n      ******************************************************************        \n      * Remap PFkeys as needed.                                                 \n      * Store the Mapped PF Key                                                 \n      *****************************************************************         \n           PERFORM YYYY-STORE-PFKEY                                             \n              THRU YYYY-STORE-PFKEY-EXIT                                        \n                                                                                \n      ******************************************************************        \n      * If something is present in commarea                                     \n      * and the from program is this program itself,                            \n      * read and edit the inputs given                                          \n      *****************************************************************         \n           IF  EIBCALEN > 0                                                     \n           AND CDEMO-FROM-PROGRAM  EQUAL LIT-THISPGM                            \n               PERFORM 2000-RECEIVE-MAP                                         \n               THRU    2000-RECEIVE-MAP-EXIT                                    \n                                                                                \n           END-IF                                                               \n      *****************************************************************         \n      * Check the mapped key  to see if its valid at this point       *         \n      * F3    - Exit                                                            \n      * Enter - List of cards for current start key                             \n      * F8    - Page down                                                       \n      * F7    - Page up                                                         \n      *****************************************************************         \n           SET PFK-INVALID TO TRUE                                              \n           IF CCARD-AID-ENTER OR                                                \n              CCARD-AID-PFK03 OR                                                \n              CCARD-AID-PFK07 OR                                                \n              CCARD-AID-PFK08                                                   \n               SET PFK-VALID TO TRUE                                            \n           END-IF                                                               \n                                                                                \n           IF PFK-INVALID                                                       \n              SET CCARD-AID-ENTER TO TRUE                                       \n           END-IF                                                               \n      *****************************************************************         \n      * If the user pressed PF3 go back to main menu                            \n      *****************************************************************         \n           IF  (CCARD-AID-PFK03                                                 \n           AND CDEMO-FROM-PROGRAM  EQUAL LIT-THISPGM)                           \n              MOVE LIT-THISTRANID   TO CDEMO-FROM-TRANID                        \n              MOVE LIT-THISPGM      TO CDEMO-FROM-PROGRAM                       \n              SET  CDEMO-USRTYP-USER TO TRUE                                    \n              SET  CDEMO-PGM-ENTER  TO TRUE                                     \n              MOVE LIT-THISMAPSET   TO CDEMO-LAST-MAPSET                        \n              MOVE LIT-THISMAP      TO CDEMO-LAST-MAP                           \n              MOVE LIT-MENUPGM      TO CDEMO-TO-PROGRAM                         \n                                                                                \n              MOVE LIT-MENUMAPSET   TO CCARD-NEXT-MAPSET                        \n              MOVE LIT-THISMAP      TO CCARD-NEXT-MAP                           \n              SET WS-EXIT-MESSAGE            TO TRUE                            \n                                                                                \n      *       CALL MENU PROGRAM                                                 \n      *                                                                         \n              SET CDEMO-PGM-ENTER   TO TRUE                                     \n      *                                                                         \n              EXEC CICS XCTL                                                    \n                        PROGRAM (LIT-MENUPGM)                                   \n                        COMMAREA(CARDDEMO-COMMAREA)                             \n              END-EXEC                                                          \n           END-IF                                                               \n      *****************************************************************         \n      * If the user did not press PF8, lets reset the last page flag            \n      *****************************************************************         \n           IF CCARD-AID-PFK08                                                   \n              CONTINUE                                                          \n           ELSE                                                                 \n              SET CA-LAST-PAGE-NOT-SHOWN   TO TRUE                              \n           END-IF                                                               \n      *****************************************************************         \n      * Now we decide what to do                                                \n      *****************************************************************         \n           EVALUATE TRUE                                                        \n               WHEN INPUT-ERROR                                                 \n      *****************************************************************         \n      *        ASK FOR CORRECTIONS TO INPUTS                                    \n      *****************************************************************         \n                    MOVE WS-ERROR-MSG    TO CCARD-ERROR-MSG                     \n                    MOVE LIT-THISPGM     TO CDEMO-FROM-PROGRAM                  \n                    MOVE LIT-THISMAPSET  TO CDEMO-LAST-MAPSET                   \n                    MOVE LIT-THISMAP     TO CDEMO-LAST-MAP                      \n                                                                                \n                    MOVE LIT-THISPGM     TO CCARD-NEXT-PROG                     \n                    MOVE LIT-THISMAPSET  TO CCARD-NEXT-MAPSET                   \n                    MOVE LIT-THISMAP     TO CCARD-NEXT-MAP                      \n                    IF  NOT FLG-ACCTFILTER-NOT-OK                               \n                    AND NOT FLG-CARDFILTER-NOT-OK                               \n                       PERFORM 9000-READ-FORWARD                                \n                          THRU 9000-READ-FORWARD-EXIT                           \n                    END-IF                                                      \n                    PERFORM 1000-SEND-MAP                                       \n                       THRU 1000-SEND-MAP                                       \n                    GO TO COMMON-RETURN                                         \n               WHEN CCARD-AID-PFK07                                             \n                    AND CA-FIRST-PAGE                                           \n      *****************************************************************         \n      *        PAGE UP - PF7 - BUT ALREADY ON FIRST PAGE                        \n      *****************************************************************         \n               WHEN CCARD-AID-PFK07                                             \n                    AND CA-FIRST-PAGE                                           \n                    MOVE WS-CA-FIRST-CARD-NUM                                   \n                                  TO WS-CARD-RID-CARDNUM                        \n      *             MOVE WS-CA-FIRST-CARD-ACCT-ID                               \n      *                           TO WS-CARD-RID-ACCT-ID                        \n                    PERFORM 9000-READ-FORWARD                                   \n                       THRU 9000-READ-FORWARD-EXIT                              \n                    PERFORM 1000-SEND-MAP                                       \n                       THRU 1000-SEND-MAP                                       \n                    GO TO COMMON-RETURN                                         \n      *****************************************************************         \n      *        BACK - PF3 IF WE CAME FROM SOME OTHER PROGRAM                    \n      *****************************************************************         \n               WHEN CCARD-AID-PFK03                                             \n               WHEN CDEMO-PGM-REENTER AND                                       \n                    CDEMO-FROM-PROGRAM NOT EQUAL LIT-THISPGM                    \n                                                                                \n                    INITIALIZE CARDDEMO-COMMAREA                                \n                               WS-THIS-PROGCOMMAREA                             \n                    MOVE LIT-THISTRANID      TO CDEMO-FROM-TRANID               \n                    MOVE LIT-THISPGM         TO CDEMO-FROM-PROGRAM              \n                    SET CDEMO-USRTYP-USER    TO TRUE                            \n                    SET CDEMO-PGM-ENTER      TO TRUE                            \n                    MOVE LIT-THISMAP         TO CDEMO-LAST-MAP                  \n                    MOVE LIT-THISMAPSET      TO CDEMO-LAST-MAPSET               \n                    SET CA-FIRST-PAGE        TO TRUE                            \n                    SET CA-LAST-PAGE-NOT-SHOWN TO TRUE                          \n                                                                                \n                    MOVE WS-CA-FIRST-CARD-NUM                                   \n                                  TO WS-CARD-RID-CARDNUM                        \n      *             MOVE WS-CA-FIRST-CARD-ACCT-ID                               \n      *                           TO WS-CARD-RID-ACCT-ID                        \n                                                                                \n                    PERFORM 9000-READ-FORWARD                                   \n                       THRU 9000-READ-FORWARD-EXIT                              \n                    PERFORM 1000-SEND-MAP                                       \n                       THRU 1000-SEND-MAP                                       \n                    GO TO COMMON-RETURN                                         \n      *****************************************************************         \n      *        PAGE DOWN                                                        \n      *****************************************************************         \n               WHEN CCARD-AID-PFK08                                             \n                    AND CA-NEXT-PAGE-EXISTS                                     \n                    MOVE WS-CA-LAST-CARD-NUM                                    \n                                  TO WS-CARD-RID-CARDNUM                        \n      *             MOVE WS-CA-LAST-CARD-ACCT-ID                                \n      *                           TO WS-CARD-RID-ACCT-ID                        \n                    ADD   +1       TO WS-CA-SCREEN-NUM                          \n                    PERFORM 9000-READ-FORWARD                                   \n                       THRU 9000-READ-FORWARD-EXIT                              \n                    PERFORM 1000-SEND-MAP                                       \n                       THRU 1000-SEND-MAP-EXIT                                  \n                    GO TO COMMON-RETURN                                         \n      *****************************************************************         \n      *        PAGE UP                                                          \n      *****************************************************************         \n               WHEN CCARD-AID-PFK07                                             \n                    AND NOT CA-FIRST-PAGE                                       \n                                                                                \n                    MOVE WS-CA-FIRST-CARD-NUM                                   \n                                  TO WS-CARD-RID-CARDNUM                        \n      *             MOVE WS-CA-FIRST-CARD-ACCT-ID                               \n      *                           TO WS-CARD-RID-ACCT-ID                        \n                    SUBTRACT 1    FROM WS-CA-SCREEN-NUM                         \n                    PERFORM 9100-READ-BACKWARDS                                 \n                       THRU 9100-READ-BACKWARDS-EXIT                            \n                    PERFORM 1000-SEND-MAP                                       \n                       THRU 1000-SEND-MAP-EXIT                                  \n                    GO TO COMMON-RETURN                                         \n      *****************************************************************         \n      *        TRANSFER TO CARD DETAIL VIEW                                     \n      *****************************************************************         \n               WHEN CCARD-AID-ENTER                                             \n                AND VIEW-REQUESTED-ON(I-SELECTED)                               \n                AND CDEMO-FROM-PROGRAM  EQUAL LIT-THISPGM                       \n                   MOVE LIT-THISTRANID    TO CDEMO-FROM-TRANID                  \n                   MOVE LIT-THISPGM       TO CDEMO-FROM-PROGRAM                 \n                   SET  CDEMO-USRTYP-USER TO TRUE                               \n                   SET  CDEMO-PGM-ENTER   TO TRUE                               \n                   MOVE LIT-THISMAPSET    TO CDEMO-LAST-MAPSET                  \n                   MOVE LIT-THISMAP       TO CDEMO-LAST-MAP                     \n                   MOVE LIT-CARDDTLPGM    TO CCARD-NEXT-PROG                    \n                                                                                \n                   MOVE LIT-CARDDTLMAPSET TO CCARD-NEXT-MAPSET                  \n                   MOVE LIT-CARDDTLMAP    TO CCARD-NEXT-MAP                     \n                                                                                \n                   MOVE WS-ROW-ACCTNO (I-SELECTED)                              \n                                          TO CDEMO-ACCT-ID                      \n                   MOVE WS-ROW-CARD-NUM (I-SELECTED)                            \n                                          TO CDEMO-CARD-NUM                     \n                                                                                \n      *            CALL CARD DETAIL PROGRAM                                     \n      *                                                                         \n                   EXEC CICS XCTL                                               \n                        PROGRAM (CCARD-NEXT-PROG)                               \n                        COMMAREA(CARDDEMO-COMMAREA)                             \n                   END-EXEC                                                     \n      *****************************************************************         \n      *        TRANSFER TO CARD UPDATED PROGRAM                                 \n      *****************************************************************         \n               WHEN CCARD-AID-ENTER                                             \n                AND UPDATE-REQUESTED-ON(I-SELECTED)                             \n                AND CDEMO-FROM-PROGRAM  EQUAL LIT-THISPGM                       \n                   MOVE LIT-THISTRANID    TO CDEMO-FROM-TRANID                  \n                   MOVE LIT-THISPGM       TO CDEMO-FROM-PROGRAM                 \n                   SET  CDEMO-USRTYP-USER TO TRUE                               \n                   SET  CDEMO-PGM-ENTER   TO TRUE                               \n                   MOVE LIT-THISMAPSET    TO CDEMO-LAST-MAPSET                  \n                   MOVE LIT-THISMAP       TO CDEMO-LAST-MAP                     \n                   MOVE LIT-CARDUPDPGM    TO CCARD-NEXT-PROG                    \n                                                                                \n                   MOVE LIT-CARDUPDMAPSET TO CCARD-NEXT-MAPSET                  \n                   MOVE LIT-CARDUPDMAP    TO CCARD-NEXT-MAP                     \n                                                                                \n                   MOVE WS-ROW-ACCTNO (I-SELECTED)                              \n                                          TO CDEMO-ACCT-ID                      \n                   MOVE WS-ROW-CARD-NUM (I-SELECTED)                            \n                                          TO CDEMO-CARD-NUM                     \n                                                                                \n      *            CALL CARD UPDATE PROGRAM                                     \n      *                                                                         \n                   EXEC CICS XCTL                                               \n                        PROGRAM (CCARD-NEXT-PROG)                               \n                        COMMAREA(CARDDEMO-COMMAREA)                             \n                   END-EXEC                                                     \n                                                                                \n      *****************************************************************         \n               WHEN OTHER                                                       \n      *****************************************************************         \n                    MOVE WS-CA-FIRST-CARD-NUM                                   \n                                  TO WS-CARD-RID-CARDNUM                        \n      *             MOVE WS-CA-FIRST-CARD-ACCT-ID                               \n      *                           TO WS-CARD-RID-ACCT-ID                        \n                    PERFORM 9000-READ-FORWARD                                   \n                       THRU 9000-READ-FORWARD-EXIT                              \n                    PERFORM 1000-SEND-MAP                                       \n                       THRU 1000-SEND-MAP                                       \n                    GO TO COMMON-RETURN                                         \n           END-EVALUATE                                                         \n                                                                                \n      * If we had an error setup error message to display and return            \n           IF INPUT-ERROR                                                       \n              MOVE WS-ERROR-MSG   TO CCARD-ERROR-MSG                            \n              MOVE LIT-THISPGM     TO CDEMO-FROM-PROGRAM                        \n              MOVE LIT-THISMAPSET  TO CDEMO-LAST-MAPSET                         \n              MOVE LIT-THISMAP     TO CDEMO-LAST-MAP                            \n                                                                                \n              MOVE LIT-THISPGM     TO CCARD-NEXT-PROG                           \n              MOVE LIT-THISMAPSET  TO CCARD-NEXT-MAPSET                         \n              MOVE LIT-THISMAP     TO CCARD-NEXT-MAP                            \n      *       PERFORM 1000-SEND-MAP                                             \n      *          THRU 1000-SEND-MAP                                             \n              GO TO COMMON-RETURN                                               \n           END-IF                                                               \n                                                                                \n           MOVE LIT-THISPGM        TO CCARD-NEXT-PROG                           \n           GO TO COMMON-RETURN                                                  \n           .                                                                    \n                                                                                \n       COMMON-RETURN.                                                           \n           MOVE  LIT-THISTRANID TO CDEMO-FROM-TRANID                            \n           MOVE  LIT-THISPGM     TO CDEMO-FROM-PROGRAM                          \n           MOVE  LIT-THISMAPSET  TO CDEMO-LAST-MAPSET                           \n           MOVE  LIT-THISMAP     TO CDEMO-LAST-MAP                              \n           MOVE  CARDDEMO-COMMAREA    TO WS-COMMAREA                            \n           MOVE  WS-THIS-PROGCOMMAREA TO                                        \n                  WS-COMMAREA(LENGTH OF CARDDEMO-COMMAREA + 1:                  \n                               LENGTH OF WS-THIS-PROGCOMMAREA )                 \n                                                                                \n                                                                                \n           EXEC CICS RETURN                                                     \n                TRANSID (LIT-THISTRANID)                                        \n                COMMAREA (WS-COMMAREA)                                          \n                LENGTH(LENGTH OF WS-COMMAREA)                                   \n           END-EXEC                                                             \n           .                                                                    \n       0000-MAIN-EXIT.                                                          \n           EXIT                                                                 \n           .                                                                    \n       1000-SEND-MAP.                                                           \n           PERFORM 1100-SCREEN-INIT                                             \n              THRU 1100-SCREEN-INIT-EXIT                                        \n           PERFORM 1200-SCREEN-ARRAY-INIT                                       \n              THRU 1200-SCREEN-ARRAY-INIT-EXIT                                  \n           PERFORM 1250-SETUP-ARRAY-ATTRIBS                                     \n              THRU 1250-SETUP-ARRAY-ATTRIBS-EXIT                                \n           PERFORM 1300-SETUP-SCREEN-ATTRS                                      \n              THRU 1300-SETUP-SCREEN-ATTRS-EXIT                                 \n           PERFORM 1400-SETUP-MESSAGE                                           \n              THRU 1400-SETUP-MESSAGE-EXIT                                      \n           PERFORM 1500-SEND-SCREEN                                             \n              THRU 1500-SEND-SCREEN-EXIT                                        \n           .                                                                    \n                                                                                \n       1000-SEND-MAP-EXIT.                                                      \n           EXIT                                                                 \n           .                                                                    \n       1100-SCREEN-INIT.                                                        \n           MOVE LOW-VALUES             TO CCRDLIAO                              \n                                                                                \n           MOVE FUNCTION CURRENT-DATE  TO WS-CURDATE-DATA                       \n                                                                                \n           MOVE CCDA-TITLE01           TO TITLE01O OF CCRDLIAO                  \n           MOVE CCDA-TITLE02           TO TITLE02O OF CCRDLIAO                  \n           MOVE LIT-THISTRANID         TO TRNNAMEO OF CCRDLIAO                  \n           MOVE LIT-THISPGM            TO PGMNAMEO OF CCRDLIAO                  \n                                                                                \n           MOVE FUNCTION CURRENT-DATE  TO WS-CURDATE-DATA                       \n                                                                                \n           MOVE WS-CURDATE-MONTH       TO WS-CURDATE-MM                         \n           MOVE WS-CURDATE-DAY         TO WS-CURDATE-DD                         \n           MOVE WS-CURDATE-YEAR(3:2)   TO WS-CURDATE-YY                         \n                                                                                \n           MOVE WS-CURDATE-MM-DD-YY    TO CURDATEO OF CCRDLIAO                  \n                                                                                \n           MOVE WS-CURTIME-HOURS       TO WS-CURTIME-HH                         \n           MOVE WS-CURTIME-MINUTE      TO WS-CURTIME-MM                         \n           MOVE WS-CURTIME-SECOND      TO WS-CURTIME-SS                         \n                                                                                \n           MOVE WS-CURTIME-HH-MM-SS    TO CURTIMEO OF CCRDLIAO                  \n      *    PAGE NUMBER                                                          \n      *                                                                         \n           MOVE WS-CA-SCREEN-NUM       TO PAGENOO  OF CCRDLIAO                  \n                                                                                \n           SET WS-NO-INFO-MESSAGE      TO TRUE                                  \n           MOVE WS-INFO-MSG            TO INFOMSGO OF CCRDLIAO                  \n           MOVE DFHBMDAR               TO INFOMSGC OF CCRDLIAO                  \n           .                                                                    \n                                                                                \n       1100-SCREEN-INIT-EXIT.                                                   \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n       1200-SCREEN-ARRAY-INIT.                                                  \n      *    USE REDEFINES AND CLEAN UP REPETITIVE CODE !!                        \n           IF   WS-EACH-CARD(1)            EQUAL LOW-VALUES                     \n              CONTINUE                                                          \n           ELSE                                                                 \n              MOVE WS-EDIT-SELECT(1)       TO CRDSEL1O OF CCRDLIAO              \n              MOVE WS-ROW-ACCTNO(1)        TO ACCTNO1O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-NUM(1)      TO CRDNUM1O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-STATUS(1)   TO CRDSTS1O OF CCRDLIAO              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(2)        EQUAL LOW-VALUES                         \n              CONTINUE                                                          \n           ELSE                                                                 \n              MOVE WS-EDIT-SELECT(2)       TO CRDSEL2O OF CCRDLIAO              \n              MOVE WS-ROW-ACCTNO(2)        TO ACCTNO2O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-NUM(2)      TO CRDNUM2O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-STATUS(2)   TO CRDSTS2O OF CCRDLIAO              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(3)        EQUAL LOW-VALUES                         \n              CONTINUE                                                          \n           ELSE                                                                 \n              MOVE WS-EDIT-SELECT(3)       TO CRDSEL3O OF CCRDLIAO              \n              MOVE WS-ROW-ACCTNO(3)        TO ACCTNO3O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-NUM(3)      TO CRDNUM3O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-STATUS(3)   TO CRDSTS3O OF CCRDLIAO              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(4)        EQUAL LOW-VALUES                         \n              CONTINUE                                                          \n           ELSE                                                                 \n              MOVE WS-EDIT-SELECT(4)       TO CRDSEL4O OF CCRDLIAO              \n              MOVE WS-ROW-ACCTNO(4)        TO ACCTNO4O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-NUM(4)      TO CRDNUM4O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-STATUS(4)   TO CRDSTS4O OF CCRDLIAO              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(5)        EQUAL LOW-VALUES                         \n              CONTINUE                                                          \n           ELSE                                                                 \n              MOVE WS-EDIT-SELECT(5)       TO CRDSEL5O OF CCRDLIAO              \n              MOVE WS-ROW-ACCTNO(5)        TO ACCTNO5O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-NUM(5)      TO CRDNUM5O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-STATUS(5)   TO CRDSTS5O OF CCRDLIAO              \n           END-IF                                                               \n                                                                                \n                                                                                \n           IF   WS-EACH-CARD(6)        EQUAL LOW-VALUES                         \n              CONTINUE                                                          \n           ELSE                                                                 \n              MOVE WS-EDIT-SELECT(6)       TO CRDSEL6O OF CCRDLIAO              \n              MOVE WS-ROW-ACCTNO(6)        TO ACCTNO6O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-NUM(6)      TO CRDNUM6O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-STATUS(6)   TO CRDSTS6O OF CCRDLIAO              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(7)        EQUAL LOW-VALUES                         \n              CONTINUE                                                          \n           ELSE                                                                 \n              MOVE WS-EDIT-SELECT(7)       TO CRDSEL7O OF CCRDLIAO              \n              MOVE WS-ROW-ACCTNO(7)        TO ACCTNO7O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-NUM(7)      TO CRDNUM7O OF CCRDLIAO              \n              MOVE WS-ROW-CARD-STATUS(7)   TO CRDSTS7O OF CCRDLIAO              \n           END-IF                                                               \n           .                                                                    \n                                                                                \n       1200-SCREEN-ARRAY-INIT-EXIT.                                             \n           EXIT                                                                 \n           .                                                                    \n       1250-SETUP-ARRAY-ATTRIBS.                                                \n      *    USE REDEFINES AND CLEAN UP REPETITIVE CODE !!                        \n                                                                                \n           IF   WS-EACH-CARD(1)            EQUAL LOW-VALUES                     \n           OR   FLG-PROTECT-SELECT-ROWS-YES                                     \n              MOVE DFHBMPRF                TO CRDSEL1A OF CCRDLIAI              \n           ELSE                                                                 \n              IF WS-ROW-CRDSELECT-ERROR(1) = '1'                                \n                 MOVE DFHRED               TO CRDSEL1C OF CCRDLIAO              \n                 IF WS-EDIT-SELECT(1) = SPACE OR LOW-VALUES                     \n                    MOVE '*'               TO CRDSEL1O OF CCRDLIAO              \n                 END-IF                                                         \n              END-IF                                                            \n              MOVE DFHBMFSE                TO CRDSEL1A OF CCRDLIAI              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(2)            EQUAL LOW-VALUES                     \n           OR   FLG-PROTECT-SELECT-ROWS-YES                                     \n              MOVE DFHBMPRO                TO CRDSEL2A OF CCRDLIAI              \n           ELSE                                                                 \n              IF WS-ROW-CRDSELECT-ERROR(2) = '1'                                \n                 MOVE DFHRED               TO CRDSEL2C OF CCRDLIAO              \n                 MOVE -1                   TO CRDSEL2L OF CCRDLIAI              \n              END-IF                                                            \n              MOVE DFHBMFSE                TO CRDSEL2A OF CCRDLIAI              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(3)            EQUAL LOW-VALUES                     \n           OR   FLG-PROTECT-SELECT-ROWS-YES                                     \n              MOVE DFHBMPRO                TO CRDSEL3A OF CCRDLIAI              \n                                                                                \n           ELSE                                                                 \n              IF WS-ROW-CRDSELECT-ERROR(3) = '1'                                \n                 MOVE DFHRED               TO CRDSEL3C OF CCRDLIAO              \n                 MOVE -1                   TO CRDSEL3L OF CCRDLIAI              \n              END-IF                                                            \n              MOVE DFHBMFSE                TO CRDSEL3A OF CCRDLIAI              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(4)            EQUAL LOW-VALUES                     \n           OR   FLG-PROTECT-SELECT-ROWS-YES                                     \n              MOVE DFHBMPRO                TO CRDSEL4A OF CCRDLIAI              \n              I                                                                 \n           ELSE                                                                 \n              IF WS-ROW-CRDSELECT-ERROR(4) = '1'                                \n                 MOVE DFHRED               TO CRDSEL4C OF CCRDLIAO              \n                 MOVE -1                   TO CRDSEL4L OF CCRDLIAI              \n              END-IF                                                            \n              MOVE DFHBMFSE                TO CRDSEL4A OF CCRDLIAI              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(5)            EQUAL LOW-VALUES                     \n           OR   FLG-PROTECT-SELECT-ROWS-YES                                     \n              MOVE DFHBMPRO                TO CRDSEL5A OF CCRDLIAI              \n           ELSE                                                                 \n              IF WS-ROW-CRDSELECT-ERROR(5) = '1'                                \n                 MOVE DFHRED               TO CRDSEL5C OF CCRDLIAO              \n                 MOVE -1                   TO CRDSEL5L OF CCRDLIAI              \n              END-IF                                                            \n              MOVE DFHBMFSE                TO CRDSEL5A OF CCRDLIAI              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(6)            EQUAL LOW-VALUES                     \n           OR   FLG-PROTECT-SELECT-ROWS-YES                                     \n              MOVE DFHBMPRO                TO CRDSEL6A OF CCRDLIAI              \n                                                                                \n           ELSE                                                                 \n              IF WS-ROW-CRDSELECT-ERROR(6) = '1'                                \n                 MOVE DFHRED               TO CRDSEL6C OF CCRDLIAO              \n                 MOVE -1                   TO CRDSEL6L OF CCRDLIAI              \n              END-IF                                                            \n              MOVE DFHBMFSE                TO CRDSEL6A OF CCRDLIAI              \n           END-IF                                                               \n                                                                                \n           IF   WS-EACH-CARD(7)            EQUAL LOW-VALUES                     \n           OR   FLG-PROTECT-SELECT-ROWS-YES                                     \n              MOVE DFHBMPRO                TO CRDSEL7A OF CCRDLIAI              \n           ELSE                                                                 \n              IF WS-ROW-CRDSELECT-ERROR(7) = '1'                                \n                 MOVE DFHRED               TO CRDSEL7C OF CCRDLIAO              \n                 MOVE -1                   TO CRDSEL7L OF CCRDLIAI              \n              END-IF                                                            \n              MOVE DFHBMFSE                TO CRDSEL7A OF CCRDLIAI              \n           END-IF                                                               \n           .                                                                    \n                                                                                \n       1250-SETUP-ARRAY-ATTRIBS-EXIT.                                           \n           EXIT                                                                 \n           .                                                                    \n       1300-SETUP-SCREEN-ATTRS.                                                 \n      *    INITIALIZE SEARCH CRITERIA                                           \n           IF EIBCALEN = 0                                                      \n           OR (CDEMO-PGM-ENTER                                                  \n           AND CDEMO-FROM-PROGRAM = LIT-MENUPGM)                                \n              CONTINUE                                                          \n           ELSE                                                                 \n              EVALUATE TRUE                                                     \n                  WHEN FLG-ACCTFILTER-ISVALID                                   \n                  WHEN FLG-ACCTFILTER-NOT-OK                                    \n                     MOVE CC-ACCT-ID   TO ACCTSIDO OF CCRDLIAO                  \n                     MOVE DFHBMFSE     TO ACCTSIDA OF CCRDLIAI                  \n                  WHEN CDEMO-ACCT-ID = 0                                        \n                     MOVE LOW-VALUES   TO ACCTSIDO OF CCRDLIAO                  \n                  WHEN OTHER                                                    \n                    MOVE CDEMO-ACCT-ID TO ACCTSIDO OF CCRDLIAO                  \n                    MOVE DFHBMFSE      TO ACCTSIDA OF CCRDLIAI                  \n              END-EVALUATE                                                      \n                                                                                \n              EVALUATE TRUE                                                     \n                  WHEN FLG-CARDFILTER-ISVALID                                   \n                  WHEN FLG-CARDFILTER-NOT-OK                                    \n                     MOVE CC-CARD-NUM  TO CARDSIDO OF CCRDLIAO                  \n                     MOVE DFHBMFSE     TO CARDSIDA OF CCRDLIAI                  \n                  WHEN CDEMO-CARD-NUM = 0                                       \n                     MOVE LOW-VALUES   TO CARDSIDO OF CCRDLIAO                  \n                  WHEN OTHER                                                    \n                    MOVE CDEMO-CARD-NUM                                         \n                                       TO CARDSIDO OF CCRDLIAO                  \n                    MOVE DFHBMFSE      TO CARDSIDA OF CCRDLIAI                  \n              END-EVALUATE                                                      \n           END-IF                                                               \n                                                                                \n      *    POSITION CURSOR                                                      \n                                                                                \n           IF FLG-ACCTFILTER-NOT-OK                                             \n              MOVE  DFHRED             TO ACCTSIDC OF CCRDLIAO                  \n              MOVE  -1                 TO ACCTSIDL OF CCRDLIAI                  \n           END-IF                                                               \n                                                                                \n           IF FLG-CARDFILTER-NOT-OK                                             \n              MOVE  DFHRED             TO CARDSIDC OF CCRDLIAO                  \n              MOVE  -1                 TO CARDSIDL OF CCRDLIAI                  \n           END-IF                                                               \n                                                                                \n      *    IF NO ERRORS POSITION CURSOR AT ACCTID                               \n                                                                                \n           IF INPUT-OK                                                          \n             MOVE   -1                 TO ACCTSIDL OF CCRDLIAI                  \n           END-IF                                                               \n                                                                                \n                                                                                \n           .                                                                    \n       1300-SETUP-SCREEN-ATTRS-EXIT.                                            \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n                                                                                \n       1400-SETUP-MESSAGE.                                                      \n      *    SETUP MESSAGE                                                        \n           EVALUATE TRUE                                                        \n                WHEN FLG-ACCTFILTER-NOT-OK                                      \n                WHEN FLG-CARDFILTER-NOT-OK                                      \n                  CONTINUE                                                      \n                WHEN CCARD-AID-PFK07                                            \n                    AND CA-FIRST-PAGE                                           \n                  MOVE 'NO PREVIOUS PAGES TO DISPLAY'                           \n                  TO WS-ERROR-MSG                                               \n                WHEN CCARD-AID-PFK08                                            \n                 AND CA-NEXT-PAGE-NOT-EXISTS                                    \n                 AND CA-LAST-PAGE-SHOWN                                         \n                  MOVE 'NO MORE PAGES TO DISPLAY'                               \n                  TO WS-ERROR-MSG                                               \n                WHEN CCARD-AID-PFK08                                            \n                 AND CA-NEXT-PAGE-NOT-EXISTS                                    \n                  SET WS-INFORM-REC-ACTIONS TO TRUE                             \n                  IF  CA-LAST-PAGE-NOT-SHOWN                                    \n                  AND CA-NEXT-PAGE-NOT-EXISTS                                   \n                      SET CA-LAST-PAGE-SHOWN TO TRUE                            \n                  END-IF                                                        \n                WHEN WS-NO-INFO-MESSAGE                                         \n                WHEN CA-NEXT-PAGE-EXISTS                                        \n                  SET WS-INFORM-REC-ACTIONS TO TRUE                             \n                WHEN OTHER                                                      \n                   SET WS-NO-INFO-MESSAGE TO TRUE                               \n           END-EVALUATE                                                         \n                                                                                \n           MOVE WS-ERROR-MSG          TO ERRMSGO OF CCRDLIAO                    \n                                                                                \n           IF  NOT WS-NO-INFO-MESSAGE                                           \n           AND NOT WS-NO-RECORDS-FOUND                                          \n              MOVE WS-INFO-MSG        TO INFOMSGO OF CCRDLIAO                   \n              MOVE DFHNEUTR           TO INFOMSGC OF CCRDLIAO                   \n           END-IF                                                               \n                                                                                \n           .                                                                    \n       1400-SETUP-MESSAGE-EXIT.                                                 \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n                                                                                \n       1500-SEND-SCREEN.                                                        \n           EXEC CICS SEND MAP(LIT-THISMAP)                                      \n                          MAPSET(LIT-THISMAPSET)                                \n                          FROM(CCRDLIAO)                                        \n                          CURSOR                                                \n                          ERASE                                                 \n                          RESP(WS-RESP-CD)                                      \n                          FREEKB                                                \n           END-EXEC                                                             \n           .                                                                    \n       1500-SEND-SCREEN-EXIT.                                                   \n           EXIT                                                                 \n           .                                                                    \n       2000-RECEIVE-MAP.                                                        \n           PERFORM 2100-RECEIVE-SCREEN                                          \n              THRU 2100-RECEIVE-SCREEN-EXIT                                     \n                                                                                \n           PERFORM 2200-EDIT-INPUTS                                             \n            THRU   2200-EDIT-INPUTS-EXIT                                        \n           .                                                                    \n                                                                                \n       2000-RECEIVE-MAP-EXIT.                                                   \n           EXIT                                                                 \n           .                                                                    \n       2100-RECEIVE-SCREEN.                                                     \n           EXEC CICS RECEIVE MAP(LIT-THISMAP)                                   \n                          MAPSET(LIT-THISMAPSET)                                \n                          INTO(CCRDLIAI)                                        \n                          RESP(WS-RESP-CD)                                      \n           END-EXEC                                                             \n                                                                                \n           MOVE ACCTSIDI OF CCRDLIAI  TO CC-ACCT-ID                             \n           MOVE CARDSIDI OF CCRDLIAI  TO CC-CARD-NUM                            \n                                                                                \n           MOVE CRDSEL1I OF CCRDLIAI  TO WS-EDIT-SELECT(1)                      \n           MOVE CRDSEL2I OF CCRDLIAI  TO WS-EDIT-SELECT(2)                      \n           MOVE CRDSEL3I OF CCRDLIAI  TO WS-EDIT-SELECT(3)                      \n           MOVE CRDSEL4I OF CCRDLIAI  TO WS-EDIT-SELECT(4)                      \n           MOVE CRDSEL5I OF CCRDLIAI  TO WS-EDIT-SELECT(5)                      \n           MOVE CRDSEL6I OF CCRDLIAI  TO WS-EDIT-SELECT(6)                      \n           MOVE CRDSEL7I OF CCRDLIAI  TO WS-EDIT-SELECT(7)                      \n           .                                                                    \n                                                                                \n       2100-RECEIVE-SCREEN-EXIT.                                                \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n       2200-EDIT-INPUTS.                                                        \n           SET INPUT-OK                   TO TRUE                               \n           SET FLG-PROTECT-SELECT-ROWS-NO TO TRUE                               \n                                                                                \n           PERFORM 2210-EDIT-ACCOUNT                                            \n              THRU 2210-EDIT-ACCOUNT-EXIT                                       \n                                                                                \n           PERFORM 2220-EDIT-CARD                                               \n              THRU 2220-EDIT-CARD-EXIT                                          \n                                                                                \n           PERFORM 2250-EDIT-ARRAY                                              \n              THRU 2250-EDIT-ARRAY-EXIT                                         \n           .                                                                    \n                                                                                \n       2200-EDIT-INPUTS-EXIT.                                                   \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n       2210-EDIT-ACCOUNT.                                                       \n           SET FLG-ACCTFILTER-BLANK TO TRUE                                     \n                                                                                \n      *    Not supplied                                                         \n           IF CC-ACCT-ID   EQUAL LOW-VALUES                                     \n           OR CC-ACCT-ID   EQUAL SPACES                                         \n           OR CC-ACCT-ID-N EQUAL ZEROS                                          \n              SET FLG-ACCTFILTER-BLANK  TO TRUE                                 \n              MOVE ZEROES       TO CDEMO-ACCT-ID                                \n              GO TO  2210-EDIT-ACCOUNT-EXIT                                     \n           END-IF                                                               \n      *                                                                         \n      *    Not numeric                                                          \n      *    Not 11 characters                                                    \n           IF CC-ACCT-ID  IS NOT NUMERIC                                        \n              SET INPUT-ERROR TO TRUE                                           \n              SET FLG-ACCTFILTER-NOT-OK TO TRUE                                 \n              SET FLG-PROTECT-SELECT-ROWS-YES TO TRUE                           \n              MOVE                                                              \n              'ACCOUNT FILTER,IF SUPPLIED MUST BE A 11 DIGIT NUMBER'            \n                              TO WS-ERROR-MSG                                   \n              MOVE ZERO       TO CDEMO-ACCT-ID                                  \n              GO TO 2210-EDIT-ACCOUNT-EXIT                                      \n           ELSE                                                                 \n              MOVE CC-ACCT-ID TO CDEMO-ACCT-ID                                  \n              SET FLG-ACCTFILTER-ISVALID TO TRUE                                \n           END-IF                                                               \n           .                                                                    \n                                                                                \n       2210-EDIT-ACCOUNT-EXIT.                                                  \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n       2220-EDIT-CARD.                                                          \n      *    Not numeric                                                          \n      *    Not 16 characters                                                    \n           SET FLG-CARDFILTER-BLANK TO TRUE                                     \n                                                                                \n      *    Not supplied                                                         \n           IF CC-CARD-NUM   EQUAL LOW-VALUES                                    \n           OR CC-CARD-NUM   EQUAL SPACES                                        \n           OR CC-CARD-NUM-N EQUAL ZEROS                                         \n              SET FLG-CARDFILTER-BLANK  TO TRUE                                 \n              MOVE ZEROES       TO CDEMO-CARD-NUM                               \n              GO TO  2220-EDIT-CARD-EXIT                                        \n           END-IF                                                               \n      *                                                                         \n      *    Not numeric                                                          \n      *    Not 16 characters                                                    \n           IF CC-CARD-NUM  IS NOT NUMERIC                                       \n              SET INPUT-ERROR TO TRUE                                           \n              SET FLG-CARDFILTER-NOT-OK TO TRUE                                 \n              SET FLG-PROTECT-SELECT-ROWS-YES TO TRUE                           \n              IF WS-ERROR-MSG-OFF                                               \n                 MOVE                                                           \n              'CARD ID FILTER,IF SUPPLIED MUST BE A 16 DIGIT NUMBER'            \n                              TO WS-ERROR-MSG                                   \n              END-IF                                                            \n              MOVE ZERO       TO CDEMO-CARD-NUM                                 \n              GO TO 2220-EDIT-CARD-EXIT                                         \n           ELSE                                                                 \n              MOVE CC-CARD-NUM-N TO CDEMO-CARD-NUM                              \n              SET FLG-CARDFILTER-ISVALID TO TRUE                                \n           END-IF                                                               \n           .                                                                    \n                                                                                \n       2220-EDIT-CARD-EXIT.                                                     \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n       2250-EDIT-ARRAY.                                                         \n                                                                                \n           IF INPUT-ERROR                                                       \n              GO TO 2250-EDIT-ARRAY-EXIT                                        \n           END-IF                                                               \n                                                                                \n           INSPECT  WS-EDIT-SELECT-FLAGS                                        \n           TALLYING I                                                           \n           FOR ALL 'S'                                                          \n               ALL 'U'                                                          \n                                                                                \n           IF I > +1                                                            \n               SET INPUT-ERROR      TO TRUE                                     \n               SET WS-MORE-THAN-1-ACTION TO TRUE                                \n                                                                                \n               MOVE WS-EDIT-SELECT-FLAGS                                        \n                                   TO WS-EDIT-SELECT-ERROR-FLAGS                \n               INSPECT WS-EDIT-SELECT-ERROR-FLAGS                               \n                 REPLACING ALL 'S' BY '1'                                       \n                           ALL 'U' BY '1'                                       \n                 CHARACTERS        BY '0'                                       \n                                                                                \n           END-IF                                                               \n                                                                                \n           MOVE ZERO TO I-SELECTED                                              \n                                                                                \n           PERFORM VARYING I FROM 1 BY 1 UNTIL I > 7                            \n               EVALUATE TRUE                                                    \n                 WHEN SELECT-OK(I)                                              \n                   MOVE I TO I-SELECTED                                         \n                   IF WS-MORE-THAN-1-ACTION                                     \n                      MOVE '1' TO WS-ROW-CRDSELECT-ERROR(I)                     \n                   END-IF                                                       \n                 WHEN SELECT-BLANK(I)                                           \n                   CONTINUE                                                     \n                 WHEN OTHER                                                     \n                   SET INPUT-ERROR TO TRUE                                      \n                   MOVE '1' TO WS-ROW-CRDSELECT-ERROR(I)                        \n                   IF WS-ERROR-MSG-OFF                                          \n                      SET WS-INVALID-ACTION-CODE TO TRUE                        \n                   END-IF                                                       \n              END-EVALUATE                                                      \n           END-PERFORM                                                          \n                                                                                \n           .                                                                    \n                                                                                \n       2250-EDIT-ARRAY-EXIT.                                                    \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n       9000-READ-FORWARD.                                                       \n           MOVE LOW-VALUES           TO WS-ALL-ROWS                             \n                                                                                \n      *****************************************************************         \n      *    Start Browse                                                         \n      *****************************************************************         \n           EXEC CICS STARTBR                                                    \n                DATASET(LIT-CARD-FILE)                                          \n                RIDFLD(WS-CARD-RID-CARDNUM)                                     \n                KEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)                        \n                GTEQ                                                            \n                RESP(WS-RESP-CD)                                                \n                RESP2(WS-REAS-CD)                                               \n           END-EXEC                                                             \n      *****************************************************************         \n      *    Loop through records and fetch max screen records                    \n      *****************************************************************         \n           MOVE ZEROES TO WS-SCRN-COUNTER                                       \n           SET CA-NEXT-PAGE-EXISTS    TO TRUE                                   \n           SET MORE-RECORDS-TO-READ   TO TRUE                                   \n                                                                                \n           PERFORM UNTIL READ-LOOP-EXIT                                         \n                                                                                \n           EXEC CICS READNEXT                                                   \n                DATASET(LIT-CARD-FILE)                                          \n                INTO (CARD-RECORD)                                              \n                LENGTH(LENGTH OF CARD-RECORD)                                   \n                RIDFLD(WS-CARD-RID-CARDNUM)                                     \n                KEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)                        \n                RESP(WS-RESP-CD)                                                \n                RESP2(WS-REAS-CD)                                               \n           END-EXEC                                                             \n                                                                                \n           EVALUATE WS-RESP-CD                                                  \n               WHEN DFHRESP(NORMAL)                                             \n               WHEN DFHRESP(DUPREC)                                             \n                   PERFORM 9500-FILTER-RECORDS                                  \n                      THRU 9500-FILTER-RECORDS-EXIT                             \n                                                                                \n                   IF WS-DONOT-EXCLUDE-THIS-RECORD                              \n                      ADD 1             TO WS-SCRN-COUNTER                      \n                                                                                \n                      MOVE CARD-NUM     TO WS-ROW-CARD-NUM(                     \n                      WS-SCRN-COUNTER)                                          \n                      MOVE CARD-ACCT-ID TO                                      \n                      WS-ROW-ACCTNO(WS-SCRN-COUNTER)                            \n                      MOVE CARD-ACTIVE-STATUS                                   \n                                        TO WS-ROW-CARD-STATUS(                  \n                                        WS-SCRN-COUNTER)                        \n                                                                                \n                      IF WS-SCRN-COUNTER = 1                                    \n                         MOVE CARD-ACCT-ID                                      \n                                        TO WS-CA-FIRST-CARD-ACCT-ID             \n                         MOVE CARD-NUM  TO WS-CA-FIRST-CARD-NUM                 \n                         IF   WS-CA-SCREEN-NUM = 0                              \n                           ADD   +1     TO WS-CA-SCREEN-NUM                     \n                         ELSE                                                   \n                           CONTINUE                                             \n                         END-IF                                                 \n                      ELSE                                                      \n                         CONTINUE                                               \n                      END-IF                                                    \n                   ELSE                                                         \n                       CONTINUE                                                 \n                   END-IF                                                       \n      ******************************************************************        \n      *            Max Screen size                                              \n      ******************************************************************        \n                   IF WS-SCRN-COUNTER = WS-MAX-SCREEN-LINES                     \n                      SET READ-LOOP-EXIT  TO TRUE                               \n                                                                                \n                      MOVE CARD-ACCT-ID     TO WS-CA-LAST-CARD-ACCT-ID          \n                      MOVE CARD-NUM         TO WS-CA-LAST-CARD-NUM              \n                                                                                \n                      EXEC CICS READNEXT                                        \n                        DATASET(LIT-CARD-FILE)                                  \n                        INTO (CARD-RECORD)                                      \n                        LENGTH(LENGTH OF CARD-RECORD)                           \n                        RIDFLD(WS-CARD-RID-CARDNUM)                             \n                        KEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)                \n                        RESP(WS-RESP-CD)                                        \n                        RESP2(WS-REAS-CD)                                       \n                      END-EXEC                                                  \n                                                                                \n                      EVALUATE WS-RESP-CD                                       \n                         WHEN DFHRESP(NORMAL)                                   \n                         WHEN DFHRESP(DUPREC)                                   \n                              SET CA-NEXT-PAGE-EXISTS                           \n                                                TO TRUE                         \n                              MOVE CARD-ACCT-ID TO                              \n                                   WS-CA-LAST-CARD-ACCT-ID                      \n                              MOVE CARD-NUM     TO WS-CA-LAST-CARD-NUM          \n                        WHEN DFHRESP(ENDFILE)                                   \n                            SET CA-NEXT-PAGE-NOT-EXISTS     TO TRUE             \n                                                                                \n                            IF WS-ERROR-MSG-OFF                                 \n                                MOVE 'NO MORE RECORDS TO SHOW'                  \n                                                TO WS-ERROR-MSG                 \n                            END-IF                                              \n                            WHEN OTHER                                          \n      *                     This is some kind of error. Change to END BR        \n      *                     And exit                                            \n                            SET READ-LOOP-EXIT      TO TRUE                     \n                            MOVE 'READ'              TO ERROR-OPNAME            \n                            MOVE LIT-CARD-FILE       TO ERROR-FILE              \n                            MOVE WS-RESP-CD          TO ERROR-RESP              \n                            MOVE WS-REAS-CD          TO ERROR-RESP2             \n                          MOVE WS-FILE-ERROR-MESSAGE TO WS-ERROR-MSG            \n                      END-EVALUATE                                              \n                  END-IF                                                        \n               WHEN DFHRESP(ENDFILE)                                            \n                  SET READ-LOOP-EXIT              TO TRUE                       \n                  SET CA-NEXT-PAGE-NOT-EXISTS     TO TRUE                       \n                  MOVE CARD-ACCT-ID     TO WS-CA-LAST-CARD-ACCT-ID              \n                  MOVE CARD-NUM         TO WS-CA-LAST-CARD-NUM                  \n                  IF WS-ERROR-MSG-OFF                                           \n                     MOVE 'NO MORE RECORDS TO SHOW'  TO WS-ERROR-MSG            \n                  END-IF                                                        \n                  IF WS-CA-SCREEN-NUM = 1                                       \n                  AND WS-SCRN-COUNTER = 0                                       \n      *               MOVE 'NO RECORDS TO SHOW'  TO WS-ERROR-MSG                \n                      SET WS-NO-RECORDS-FOUND    TO TRUE                        \n                  END-IF                                                        \n               WHEN OTHER                                                       \n      *           This is some kind of error. Change to END BR                  \n      *           And exit                                                      \n                  SET READ-LOOP-EXIT             TO TRUE                        \n                  MOVE 'READ'                     TO ERROR-OPNAME               \n                  MOVE LIT-CARD-FILE              TO ERROR-FILE                 \n                  MOVE WS-RESP-CD                 TO ERROR-RESP                 \n                  MOVE WS-REAS-CD                 TO ERROR-RESP2                \n                  MOVE WS-FILE-ERROR-MESSAGE      TO WS-ERROR-MSG               \n           END-EVALUATE                                                         \n           END-PERFORM                                                          \n                                                                                \n           EXEC CICS ENDBR FILE(LIT-CARD-FILE)                                  \n           END-EXEC                                                             \n           .                                                                    \n       9000-READ-FORWARD-EXIT.                                                  \n           EXIT                                                                 \n           .                                                                    \n       9100-READ-BACKWARDS.                                                     \n                                                                                \n           MOVE LOW-VALUES           TO WS-ALL-ROWS                             \n                                                                                \n           MOVE WS-CA-FIRST-CARDKEY  TO WS-CA-LAST-CARDKEY                      \n                                                                                \n      *****************************************************************         \n      *    Start Browse                                                         \n      *****************************************************************         \n           EXEC CICS STARTBR                                                    \n                DATASET(LIT-CARD-FILE)                                          \n                RIDFLD(WS-CARD-RID-CARDNUM)                                     \n                KEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)                        \n                GTEQ                                                            \n                RESP(WS-RESP-CD)                                                \n                RESP2(WS-REAS-CD)                                               \n           END-EXEC                                                             \n      *****************************************************************         \n      *    Loop through records and fetch max screen records                    \n      *****************************************************************         \n           COMPUTE WS-SCRN-COUNTER =                                            \n                                   WS-MAX-SCREEN-LINES + 1                      \n           END-COMPUTE                                                          \n           SET CA-NEXT-PAGE-EXISTS    TO TRUE                                   \n           SET MORE-RECORDS-TO-READ   TO TRUE                                   \n                                                                                \n      *****************************************************************         \n      *    Now we show the records from previous set.                           \n      *****************************************************************         \n                                                                                \n           EXEC CICS READPREV                                                   \n                DATASET(LIT-CARD-FILE)                                          \n                INTO (CARD-RECORD)                                              \n                LENGTH(LENGTH OF CARD-RECORD)                                   \n                RIDFLD(WS-CARD-RID-CARDNUM)                                     \n                KEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)                        \n                RESP(WS-RESP-CD)                                                \n                RESP2(WS-REAS-CD)                                               \n           END-EXEC                                                             \n                                                                                \n           EVALUATE WS-RESP-CD                                                  \n               WHEN DFHRESP(NORMAL)                                             \n               WHEN DFHRESP(DUPREC)                                             \n                   SUBTRACT 1          FROM WS-SCRN-COUNTER                     \n               WHEN OTHER                                                       \n      *           This is some kind of error. Change to END BR                  \n      *           And exit                                                      \n                  SET READ-LOOP-EXIT             TO TRUE                        \n                  MOVE 'READ'                     TO ERROR-OPNAME               \n                  MOVE LIT-CARD-FILE              TO ERROR-FILE                 \n                  MOVE WS-RESP-CD                 TO ERROR-RESP                 \n                  MOVE WS-REAS-CD                 TO ERROR-RESP2                \n                  MOVE WS-FILE-ERROR-MESSAGE      TO WS-ERROR-MSG               \n                  GO TO 9100-READ-BACKWARDS-EXIT                                \n           END-EVALUATE                                                         \n                                                                                \n           PERFORM UNTIL READ-LOOP-EXIT                                         \n                                                                                \n           EXEC CICS READPREV                                                   \n                DATASET(LIT-CARD-FILE)                                          \n                INTO (CARD-RECORD)                                              \n                LENGTH(LENGTH OF CARD-RECORD)                                   \n                RIDFLD(WS-CARD-RID-CARDNUM)                                     \n                KEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)                        \n                RESP(WS-RESP-CD)                                                \n                RESP2(WS-REAS-CD)                                               \n           END-EXEC                                                             \n                                                                                \n           EVALUATE WS-RESP-CD                                                  \n               WHEN DFHRESP(NORMAL)                                             \n               WHEN DFHRESP(DUPREC)                                             \n                   PERFORM 9500-FILTER-RECORDS                                  \n                      THRU 9500-FILTER-RECORDS-EXIT                             \n                   IF WS-DONOT-EXCLUDE-THIS-RECORD                              \n                      MOVE CARD-NUM                                             \n                                  TO WS-ROW-CARD-NUM(WS-SCRN-COUNTER)           \n                      MOVE CARD-ACCT-ID                                         \n                                  TO WS-ROW-ACCTNO(WS-SCRN-COUNTER)             \n                      MOVE CARD-ACTIVE-STATUS                                   \n                                  TO                                            \n                                  WS-ROW-CARD-STATUS(WS-SCRN-COUNTER)           \n                                                                                \n                      SUBTRACT 1  FROM WS-SCRN-COUNTER                          \n                      IF WS-SCRN-COUNTER = 0                                    \n                         SET READ-LOOP-EXIT  TO TRUE                            \n                                                                                \n                         MOVE CARD-ACCT-ID                                      \n                                  TO WS-CA-FIRST-CARD-ACCT-ID                   \n                         MOVE CARD-NUM                                          \n                                  TO WS-CA-FIRST-CARD-NUM                       \n                      ELSE                                                      \n                         CONTINUE                                               \n                      END-IF                                                    \n                   ELSE                                                         \n                       CONTINUE                                                 \n                   END-IF                                                       \n                                                                                \n               WHEN OTHER                                                       \n      *           This is some kind of error. Change to END BR                  \n      *           And exit                                                      \n                  SET READ-LOOP-EXIT             TO TRUE                        \n                  MOVE 'READ'                     TO ERROR-OPNAME               \n                  MOVE LIT-CARD-FILE              TO ERROR-FILE                 \n                  MOVE WS-RESP-CD                 TO ERROR-RESP                 \n                  MOVE WS-REAS-CD                 TO ERROR-RESP2                \n                  MOVE WS-FILE-ERROR-MESSAGE      TO WS-ERROR-MSG               \n           END-EVALUATE                                                         \n           END-PERFORM                                                          \n           .                                                                    \n                                                                                \n       9100-READ-BACKWARDS-EXIT.                                                \n           EXEC CICS                                                            \n                ENDBR FILE(LIT-CARD-FILE)                                       \n           END-EXEC                                                             \n                                                                                \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n       9500-FILTER-RECORDS.                                                     \n           SET WS-DONOT-EXCLUDE-THIS-RECORD TO TRUE                             \n                                                                                \n           IF FLG-ACCTFILTER-ISVALID                                            \n              IF  CARD-ACCT-ID = CC-ACCT-ID                                     \n                  CONTINUE                                                      \n              ELSE                                                              \n                  SET WS-EXCLUDE-THIS-RECORD  TO TRUE                           \n                  GO TO 9500-FILTER-RECORDS-EXIT                                \n              END-IF                                                            \n           ELSE                                                                 \n             CONTINUE                                                           \n           END-IF                                                               \n                                                                                \n           IF FLG-CARDFILTER-ISVALID                                            \n              IF  CARD-NUM = CC-CARD-NUM-N                                      \n                  CONTINUE                                                      \n              ELSE                                                              \n                  SET WS-EXCLUDE-THIS-RECORD TO TRUE                            \n                  GO TO 9500-FILTER-RECORDS-EXIT                                \n              END-IF                                                            \n           ELSE                                                                 \n             CONTINUE                                                           \n           END-IF                                                               \n                                                                                \n           .                                                                    \n                                                                                \n       9500-FILTER-RECORDS-EXIT.                                                \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n      *****************************************************************\n      *Common code to store PFKey                                      \n      *****************************************************************\n       COPY 'CSSTRPFY'\n           .\n\n      *****************************************************************         \n      * Plain text exit - Dont use in production                      *         \n      *****************************************************************         \n       SEND-PLAIN-TEXT.                                                         \n           EXEC CICS SEND TEXT                                                  \n                     FROM(WS-ERROR-MSG)                                         \n                     LENGTH(LENGTH OF WS-ERROR-MSG)                             \n                     ERASE                                                      \n                     FREEKB                                                     \n           END-EXEC                                                             \n                                                                                \n           EXEC CICS RETURN                                                     \n           END-EXEC                                                             \n           .                                                                    \n       SEND-PLAIN-TEXT-EXIT.                                                    \n           EXIT                                                                 \n           .                                                                    \n      *****************************************************************         \n      * Display Long text and exit                                    *         \n      * This is primarily for debugging and should not be used in     *         \n      * regular course                                                *         \n      *****************************************************************         \n       SEND-LONG-TEXT.                                                          \n           EXEC CICS SEND TEXT                                                  \n                     FROM(WS-LONG-MSG)                                          \n                     LENGTH(LENGTH OF WS-LONG-MSG)                              \n                     ERASE                                                      \n                     FREEKB                                                     \n           END-EXEC                                                             \n                                                                                \n           EXEC CICS RETURN                                                     \n           END-EXEC                                                             \n           .                                                                    \n       SEND-LONG-TEXT-EXIT.                                                     \n           EXIT                                                                 \n           .                                                                    \n                                                                                \n                                                                                \n      *\n      * Ver: CardDemo_v1.0-15-g27d6c6f-68 Date: 2022-07-19 23:12:33 CDT\n      *\n",
  "children": [
    {
      "name": "IDENTIFICATION DIVISION",
      "text": "",
      "children": []
    },
    {
      "name": "ENVIRONMENT DIVISION",
      "text": "",
      "children": [
        {
          "name": "INPUT-OUTPUT SECTION",
          "text": "",
          "children": []
        }
      ]
    },
    {
      "name": "DATA DIVISION",
      "text": "",
      "children": [
        {
          "name": "WORKING-STORAGE SECTION",
          "text": "",
          "children": [
            {
              "name": "LOW-VALUES",
              "text": "01  WS-MISC-STORAGE.\n******************************************************************\n* General CICS related\n******************************************************************\n\n05 WS-CICS-PROCESSNG-VARS.\n07 WS-RESP-CD                          PIC S9(09) COMP\nVALUE ZEROS.\n07 WS-REAS-CD                          PIC S9(09) COMP\nVALUE ZEROS.\n07 WS-TRANID                           PIC X(4)\nVALUE SPACES.\n******************************************************************\n* Input edits\n******************************************************************\n05 WS-INPUT-FLAG                          PIC X(1).\n88  INPUT-OK                            VALUES '0'\n' '\n88  INPUT-ERROR                         VALUE '1'.\n05  WS-EDIT-ACCT-FLAG                     PIC X(1).\n88  FLG-ACCTFILTER-NOT-OK               VALUE '0'.\n88  FLG-ACCTFILTER-ISVALID             VALUE '1'.\n88  FLG-ACCTFILTER-BLANK                VALUE ' '.\n05  WS-EDIT-CARD-FLAG                     PIC X(1).\n88  FLG-CARDFILTER-NOT-OK               VALUE '0'.\n88  FLG-CARDFILTER-ISVALID             VALUE '1'.\n88  FLG-CARDFILTER-BLANK                VALUE ' '.\n05 WS-EDIT-SELECT-COUNTER                PIC S9(04)\nUSAGE COMP-3\nVALUE 0.\n05 WS-EDIT-SELECT-FLAGS                  PIC X(7)\nVALUE LOW-VALUES.\n05 WS-EDIT-SELECT-ARRAY REDEFINES  WS-EDIT-SELECT-FLAGS.\n10 WS-EDIT-SELECT                      PIC X(1)\nOCCURS 7 TIMES.\n88 SELECT-OK                        VALUES 'S', 'U'.\n88 VIEW-REQUESTED-ON                VALUE 'S'.\n88 UPDATE-REQUESTED-ON              VALUE 'U'.\n88 SELECT-BLANK                     VALUES\n' ',",
              "children": []
            },
            {
              "name": "LOW-VALUES",
              "text": "05 WS-EDIT-SELECT-ERROR-FLAGS             PIC X(7).\n05 WS-EDIT-SELECT-ERROR-FLAGX     REDEFINES",
              "children": []
            },
            {
              "name": "WS-EDIT-SELECT-ERROR-FLAGS",
              "text": "10 WS-EDIT-SELECT-ERRORS OCCURS 7 TIMES.\n20 WS-ROW-CRDSELECT-ERROR          PIC X(1).\n88 WS-ROW-SELECT-ERROR          VALUE '1'.\n05 WS-SUBSCRIPT-VARS.\n10 I                                  PIC S9(4) COMP\nVALUE 0.\n10 I-SELECTED                         PIC S9(4) COMP\nVALUE 0.\n88 DETAIL-WAS-REQUESTED            VALUES 1 THRU 7.\n******************************************************************\n* Output edits\n******************************************************************\n05 CICS-OUTPUT-EDIT-VARS.\n10  CARD-ACCT-ID-X                      PIC X(11).\n10  CARD-ACCT-ID-N REDEFINES CARD-ACCT-ID-X\nPIC 9(11).\n10  CARD-CVV-CD-X                       PIC X(03).\n10  CARD-CVV-CD-N REDEFINES  CARD-CVV-CD-X\nPIC 9(03).\n10  FLG-PROTECT-SELECT-ROWS             PIC X(1).\n88  FLG-PROTECT-SELECT-ROWS-NO          VALUE '0'.\n88  FLG-PROTECT-SELECT-ROWS-YES         VALUE '1'.\n******************************************************************\n* Output Message Construction\n******************************************************************\n05  WS-LONG-MSG                           PIC X(500).\n05  WS-INFO-MSG                           PIC X(45).\n88  WS-NO-INFO-MESSAGE                 VALUES\nSPACES LOW-VALUES.\n88  WS-INFORM-REC-ACTIONS          VALUE\n'TYPE S FOR DETAIL, U TO UPDATE ANY RECORD'.\n05  WS-ERROR-MSG                         PIC X(75).\n88  WS-ERROR-MSG-OFF                   VALUE SPACES.\n88  WS-EXIT-MESSAGE                     VALUE\n'PF03 PRESSED.EXITING'.\n88  WS-NO-RECORDS-FOUND                 VALUE\n'NO RECORDS FOUND FOR THIS SEARCH CONDITION.'.\n88  WS-MORE-THAN-1-ACTION              VALUE\n'PLEASE SELECT ONLY ONE RECORD TO VIEW OR UPDATE'.\n88  WS-INVALID-ACTION-CODE              VALUE\n'INVALID ACTION CODE'.\n05  WS-PFK-FLAG                           PIC X(1).\n88  PFK-VALID                           VALUE '0'.\n88  PFK-INVALID                         VALUE '1'.\n05  WS-CONTEXT-FLAG                       PIC X(1).\n88  WS-CONTEXT-FRESH-START              VALUE '0'.\n88  WS-CONTEXT-FRESH-START-NO           VALUE '1'.\n******************************************************************\n* File and data Handling\n******************************************************************\n05 WS-FILE-HANDLING-VARS.\n10  WS-CARD-RID.\n20  WS-CARD-RID-CARDNUM            PIC X(16).\n20  WS-CARD-RID-ACCT-ID            PIC 9(11).\n20  WS-CARD-RID-ACCT-ID-X          REDEFINES\nWS-CARD-RID-ACCT-ID            PIC X(11).\n\n\n\n05  WS-SCRN-COUNTER               PIC S9(4) COMP VALUE 0.\n\n05  WS-FILTER-RECORD-FLAG                 PIC X(1).\n88  WS-EXCLUDE-THIS-RECORD               VALUE '0'.\n88  WS-DONOT-EXCLUDE-THIS-RECORD         VALUE '1'.\n05  WS-RECORDS-TO-PROCESS-FLAG            PIC X(1).\n88  READ-LOOP-EXIT                      VALUE '0'.\n88  MORE-RECORDS-TO-READ                VALUE '1'.\n05  WS-FILE-ERROR-MESSAGE.\n10  FILLER                              PIC X(12)\nVALUE 'File Error:'.\n10  ERROR-OPNAME                        PIC X(8)\nVALUE SPACES.\n10  FILLER                              PIC X(4)\nVALUE ' on '.\n10  ERROR-FILE                          PIC X(9)\nVALUE SPACES.\n10  FILLER                              PIC X(15)\nVALUE\n' returned RESP '.\n10  ERROR-RESP                          PIC X(10)\nVALUE SPACES.\n10  FILLER                              PIC X(7)\nVALUE ',RESP2 '.\n10  ERROR-RESP2                         PIC X(10)\nVALUE SPACES.\n10  FILLER                               PIC X(5).\n\n******************************************************************\n* Literals and Constants\n******************************************************************\n01 WS-CONSTANTS.\n05  WS-MAX-SCREEN-LINES                    PIC S9(4) COMP\nVALUE 7.\n05  LIT-THISPGM                            PIC X(8)\nVALUE 'COCRDLIC'.\n05  LIT-THISTRANID                         PIC X(4)\nVALUE 'CCLI'.\n05  LIT-THISMAPSET                         PIC X(7)\nVALUE 'COCRDLI'.\n05  LIT-THISMAP                            PIC X(7)\nVALUE 'CCRDLIA'.\n05  LIT-MENUPGM                            PIC X(8)\nVALUE 'COMEN01C'.\n05  LIT-MENUTRANID                         PIC X(4)\nVALUE 'CM00'.\n05  LIT-MENUMAPSET                         PIC X(7)\nVALUE 'COMEN01'.\n05  LIT-MENUMAP                            PIC X(7)\nVALUE 'COMEN1A'.\n05  LIT-CARDDTLPGM                         PIC X(8)\nVALUE 'COCRDSLC'.\n05  LIT-CARDDTLTRANID                      PIC X(4)\nVALUE 'CCDL'.\n05  LIT-CARDDTLMAPSET                      PIC X(7)\nVALUE 'COCRDSL'.\n05  LIT-CARDDTLMAP                         PIC X(7)\nVALUE 'CCRDSLA'.\n05  LIT-CARDUPDPGM                         PIC X(8)\nVALUE 'COCRDUPC'.\n05  LIT-CARDUPDTRANID                      PIC X(4)\nVALUE 'CCUP'.\n05  LIT-CARDUPDMAPSET                      PIC X(7)\nVALUE 'COCRDUP'.\n05  LIT-CARDUPDMAP                         PIC X(7)\nVALUE 'CCRDUPA'.\n\n\n05  LIT-CARD-FILE                          PIC X(8)\nVALUE 'CARDDAT '.\n05  LIT-CARD-FILE-ACCT-PATH                PIC X(8)\n\nVALUE 'CARDAIX '.\n******************************************************************\n*Other common working storage Variables\n******************************************************************\nCOPY CVCRD01Y.\n\n******************************************************************\n*  Commarea manipulations\n******************************************************************\n*Application Commmarea Copybook\nCOPY COCOM01Y.\n\n01 WS-THIS-PROGCOMMAREA.\n10 WS-CA-LAST-CARDKEY.\n15  WS-CA-LAST-CARD-NUM                PIC X(16).\n15  WS-CA-LAST-CARD-ACCT-ID            PIC 9(11).\n10 WS-CA-FIRST-CARDKEY.\n15  WS-CA-FIRST-CARD-NUM               PIC X(16).\n15  WS-CA-FIRST-CARD-ACCT-ID           PIC 9(11).\n\n10 WS-CA-SCREEN-NUM                       PIC 9(1).\n88 CA-FIRST-PAGE                          VALUE 1.\n10 WS-CA-LAST-PAGE-DISPLAYED              PIC 9(1).\n88 CA-LAST-PAGE-SHOWN                     VALUE 0.\n88 CA-LAST-PAGE-NOT-SHOWN                 VALUE 9.\n10 WS-CA-NEXT-PAGE-IND                    PIC X(1).\n88 CA-NEXT-PAGE-NOT-EXISTS             VALUE LOW-VALUES.\n88 CA-NEXT-PAGE-EXISTS                 VALUE 'Y'.\n\n10 WS-RETURN-FLAG                        PIC X(1).\n88  WS-RETURN-FLAG-OFF                  VALUE LOW-VALUES.\n88  WS-RETURN-FLAG-ON                   VALUE '1'.\n******************************************************************\n*  File Data Array         28 CHARS X 7 ROWS = 196\n******************************************************************\n05 WS-SCREEN-DATA.\n10 WS-ALL-ROWS                         PIC X(196).\n10 FILLER REDEFINES WS-ALL-ROWS.\n15 WS-SCREEN-ROWS OCCURS  7 TIMES.\n20 WS-EACH-ROW.\n25 WS-EACH-CARD.\n30 WS-ROW-ACCTNO           PIC X(11).\n30 WS-ROW-CARD-NUM         PIC X(16).\n30 WS-ROW-CARD-STATUS      PIC X(1).\n\n01  WS-COMMAREA                             PIC X(2000).\n\n\n\n*IBM SUPPLIED COPYBOOKS\nCOPY DFHBMSCA.\nCOPY DFHAID.\n\n*COMMON COPYBOOKS\n*Screen Titles\nCOPY COTTL01Y.\n*Credit Card Search Screen Layout\n*COPY COCRDSL.\n*Credit Card List Screen Layout\nCOPY COCRDLI.\n\n*Current Date\nCOPY CSDAT01Y.\n*Common Messages\nCOPY CSMSG01Y.\n*Abend Variables\n*COPY CSMSG02Y.\n*Signed on user data\nCOPY CSUSR01Y.\n\n*Dataset layouts\n\n*CARD RECORD LAYOUT\nCOPY CVACT02Y.",
              "children": []
            }
          ]
        },
        {
          "name": "LINKAGE SECTION",
          "text": "01  DFHCOMMAREA.\n05  FILLER                                PIC X(1)\nOCCURS 1 TO 32767 TIMES DEPENDING ON EIBCALEN.",
          "children": []
        }
      ]
    },
    {
      "name": "PROCEDURE DIVISION",
      "text": "",
      "children": [
        {
          "name": "0000-MAIN",
          "text": "INITIALIZE CC-WORK-AREA\nWS-MISC-STORAGE\nWS-COMMAREA\n\n*****************************************************************\n* Store our context\n*****************************************************************\nMOVE LIT-THISTRANID       TO WS-TRANID\n*****************************************************************\n* Ensure error message is cleared                               *\n*****************************************************************\nSET WS-ERROR-MSG-OFF  TO TRUE\n*****************************************************************\n* Retrived passed data if  any. Initialize them if first run.\n*****************************************************************\nIF EIBCALEN = 0\nINITIALIZE CARDDEMO-COMMAREA\nWS-THIS-PROGCOMMAREA\nMOVE LIT-THISTRANID        TO CDEMO-FROM-TRANID\nMOVE LIT-THISPGM           TO CDEMO-FROM-PROGRAM\nSET CDEMO-USRTYP-USER      TO TRUE\nSET CDEMO-PGM-ENTER        TO TRUE\nMOVE LIT-THISMAP           TO CDEMO-LAST-MAP\nMOVE LIT-THISMAPSET        TO CDEMO-LAST-MAPSET\nSET CA-FIRST-PAGE          TO TRUE\nSET CA-LAST-PAGE-NOT-SHOWN TO TRUE\nELSE\nMOVE DFHCOMMAREA (1:LENGTH OF CARDDEMO-COMMAREA) TO\nCARDDEMO-COMMAREA\nMOVE DFHCOMMAREA(LENGTH OF CARDDEMO-COMMAREA + 1:\nLENGTH OF WS-THIS-PROGCOMMAREA )TO\nWS-THIS-PROGCOMMAREA\nEND-IF\n*****************************************************************\n* If coming in from menu. Lets forget the past and start afresh *\n*****************************************************************\nIF (CDEMO-PGM-ENTER\nAND CDEMO-FROM-PROGRAM NOT EQUAL LIT-THISPGM)\nINITIALIZE WS-THIS-PROGCOMMAREA\nSET CDEMO-PGM-ENTER      TO TRUE\nMOVE LIT-THISMAP         TO CDEMO-LAST-MAP\nSET CA-FIRST-PAGE        TO TRUE\nSET CA-LAST-PAGE-NOT-SHOWN TO TRUE\nEND-IF\n\n******************************************************************\n* Remap PFkeys as needed.\n* Store the Mapped PF Key\n*****************************************************************\nPERFORM YYYY-STORE-PFKEY\nTHRU YYYY-STORE-PFKEY-EXIT\n\n******************************************************************\n* If something is present in commarea\n* and the from program is this program itself,\n* read and edit the inputs given\n*****************************************************************\nIF  EIBCALEN > 0\nAND CDEMO-FROM-PROGRAM  EQUAL LIT-THISPGM\nPERFORM 2000-RECEIVE-MAP\nTHRU    2000-RECEIVE-MAP-EXIT\n\nEND-IF\n*****************************************************************\n* Check the mapped key  to see if its valid at this point       *\n* F3    - Exit\n* Enter - List of cards for current start key\n* F8    - Page down\n* F7    - Page up\n*****************************************************************\nSET PFK-INVALID TO TRUE\nIF CCARD-AID-ENTER OR\nCCARD-AID-PFK03 OR\nCCARD-AID-PFK07 OR\nCCARD-AID-PFK08\nSET PFK-VALID TO TRUE\nEND-IF\n\nIF PFK-INVALID\nSET CCARD-AID-ENTER TO TRUE\nEND-IF\n*****************************************************************\n* If the user pressed PF3 go back to main menu\n*****************************************************************\nIF  (CCARD-AID-PFK03\nAND CDEMO-FROM-PROGRAM  EQUAL LIT-THISPGM)\nMOVE LIT-THISTRANID   TO CDEMO-FROM-TRANID\nMOVE LIT-THISPGM      TO CDEMO-FROM-PROGRAM\nSET  CDEMO-USRTYP-USER TO TRUE\nSET  CDEMO-PGM-ENTER  TO TRUE\nMOVE LIT-THISMAPSET   TO CDEMO-LAST-MAPSET\nMOVE LIT-THISMAP      TO CDEMO-LAST-MAP\nMOVE LIT-MENUPGM      TO CDEMO-TO-PROGRAM\n\nMOVE LIT-MENUMAPSET   TO CCARD-NEXT-MAPSET\nMOVE LIT-THISMAP      TO CCARD-NEXT-MAP\nSET WS-EXIT-MESSAGE            TO TRUE\n\n*       CALL MENU PROGRAM\n*\nSET CDEMO-PGM-ENTER   TO TRUE\n*\nEXEC CICS XCTL\nPROGRAM (LIT-MENUPGM)\nCOMMAREA(CARDDEMO-COMMAREA)\nEND-EXEC\nEND-IF\n*****************************************************************\n* If the user did not press PF8, lets reset the last page flag\n*****************************************************************\nIF CCARD-AID-PFK08\nCONTINUE\nELSE\nSET CA-LAST-PAGE-NOT-SHOWN   TO TRUE\nEND-IF\n*****************************************************************\n* Now we decide what to do\n*****************************************************************\nEVALUATE TRUE\nWHEN INPUT-ERROR\n*****************************************************************\n*        ASK FOR CORRECTIONS TO INPUTS\n*****************************************************************\nMOVE WS-ERROR-MSG    TO CCARD-ERROR-MSG\nMOVE LIT-THISPGM     TO CDEMO-FROM-PROGRAM\nMOVE LIT-THISMAPSET  TO CDEMO-LAST-MAPSET\nMOVE LIT-THISMAP     TO CDEMO-LAST-MAP\n\nMOVE LIT-THISPGM     TO CCARD-NEXT-PROG\nMOVE LIT-THISMAPSET  TO CCARD-NEXT-MAPSET\nMOVE LIT-THISMAP     TO CCARD-NEXT-MAP\nIF  NOT FLG-ACCTFILTER-NOT-OK\nAND NOT FLG-CARDFILTER-NOT-OK\nPERFORM 9000-READ-FORWARD\nTHRU 9000-READ-FORWARD-EXIT\nEND-IF\nPERFORM 1000-SEND-MAP\nTHRU 1000-SEND-MAP\nGO TO COMMON-RETURN\nWHEN CCARD-AID-PFK07\nAND CA-FIRST-PAGE\n*****************************************************************\n*        PAGE UP - PF7 - BUT ALREADY ON FIRST PAGE\n*****************************************************************\nWHEN CCARD-AID-PFK07\nAND CA-FIRST-PAGE\nMOVE WS-CA-FIRST-CARD-NUM\nTO WS-CARD-RID-CARDNUM\n*             MOVE WS-CA-FIRST-CARD-ACCT-ID\n*                           TO WS-CARD-RID-ACCT-ID\nPERFORM 9000-READ-FORWARD\nTHRU 9000-READ-FORWARD-EXIT\nPERFORM 1000-SEND-MAP\nTHRU 1000-SEND-MAP\nGO TO COMMON-RETURN\n*****************************************************************\n*        BACK - PF3 IF WE CAME FROM SOME OTHER PROGRAM\n*****************************************************************\nWHEN CCARD-AID-PFK03\nWHEN CDEMO-PGM-REENTER AND\nCDEMO-FROM-PROGRAM NOT EQUAL LIT-THISPGM\n\nINITIALIZE CARDDEMO-COMMAREA\nWS-THIS-PROGCOMMAREA\nMOVE LIT-THISTRANID      TO CDEMO-FROM-TRANID\nMOVE LIT-THISPGM         TO CDEMO-FROM-PROGRAM\nSET CDEMO-USRTYP-USER    TO TRUE\nSET CDEMO-PGM-ENTER      TO TRUE\nMOVE LIT-THISMAP         TO CDEMO-LAST-MAP\nMOVE LIT-THISMAPSET      TO CDEMO-LAST-MAPSET\nSET CA-FIRST-PAGE        TO TRUE\nSET CA-LAST-PAGE-NOT-SHOWN TO TRUE\n\nMOVE WS-CA-FIRST-CARD-NUM\nTO WS-CARD-RID-CARDNUM\n*             MOVE WS-CA-FIRST-CARD-ACCT-ID\n*                           TO WS-CARD-RID-ACCT-ID\n\nPERFORM 9000-READ-FORWARD\nTHRU 9000-READ-FORWARD-EXIT\nPERFORM 1000-SEND-MAP\nTHRU 1000-SEND-MAP\nGO TO COMMON-RETURN\n*****************************************************************\n*        PAGE DOWN\n*****************************************************************\nWHEN CCARD-AID-PFK08\nAND CA-NEXT-PAGE-EXISTS\nMOVE WS-CA-LAST-CARD-NUM\nTO WS-CARD-RID-CARDNUM\n*             MOVE WS-CA-LAST-CARD-ACCT-ID\n*                           TO WS-CARD-RID-ACCT-ID\nADD   +1       TO WS-CA-SCREEN-NUM\nPERFORM 9000-READ-FORWARD\nTHRU 9000-READ-FORWARD-EXIT\nPERFORM 1000-SEND-MAP\nTHRU 1000-SEND-MAP-EXIT\nGO TO COMMON-RETURN\n*****************************************************************\n*        PAGE UP\n*****************************************************************\nWHEN CCARD-AID-PFK07\nAND NOT CA-FIRST-PAGE\n\nMOVE WS-CA-FIRST-CARD-NUM\nTO WS-CARD-RID-CARDNUM\n*             MOVE WS-CA-FIRST-CARD-ACCT-ID\n*                           TO WS-CARD-RID-ACCT-ID\nSUBTRACT 1    FROM WS-CA-SCREEN-NUM\nPERFORM 9100-READ-BACKWARDS\nTHRU 9100-READ-BACKWARDS-EXIT\nPERFORM 1000-SEND-MAP\nTHRU 1000-SEND-MAP-EXIT\nGO TO COMMON-RETURN\n*****************************************************************\n*        TRANSFER TO CARD DETAIL VIEW\n*****************************************************************\nWHEN CCARD-AID-ENTER\nAND VIEW-REQUESTED-ON(I-SELECTED)\nAND CDEMO-FROM-PROGRAM  EQUAL LIT-THISPGM\nMOVE LIT-THISTRANID    TO CDEMO-FROM-TRANID\nMOVE LIT-THISPGM       TO CDEMO-FROM-PROGRAM\nSET  CDEMO-USRTYP-USER TO TRUE\nSET  CDEMO-PGM-ENTER   TO TRUE\nMOVE LIT-THISMAPSET    TO CDEMO-LAST-MAPSET\nMOVE LIT-THISMAP       TO CDEMO-LAST-MAP\nMOVE LIT-CARDDTLPGM    TO CCARD-NEXT-PROG\n\nMOVE LIT-CARDDTLMAPSET TO CCARD-NEXT-MAPSET\nMOVE LIT-CARDDTLMAP    TO CCARD-NEXT-MAP\n\nMOVE WS-ROW-ACCTNO (I-SELECTED)\nTO CDEMO-ACCT-ID\nMOVE WS-ROW-CARD-NUM (I-SELECTED)\nTO CDEMO-CARD-NUM\n\n*            CALL CARD DETAIL PROGRAM\n*\nEXEC CICS XCTL\nPROGRAM (CCARD-NEXT-PROG)\nCOMMAREA(CARDDEMO-COMMAREA)\nEND-EXEC\n*****************************************************************\n*        TRANSFER TO CARD UPDATED PROGRAM\n*****************************************************************\nWHEN CCARD-AID-ENTER\nAND UPDATE-REQUESTED-ON(I-SELECTED)\nAND CDEMO-FROM-PROGRAM  EQUAL LIT-THISPGM\nMOVE LIT-THISTRANID    TO CDEMO-FROM-TRANID\nMOVE LIT-THISPGM       TO CDEMO-FROM-PROGRAM\nSET  CDEMO-USRTYP-USER TO TRUE\nSET  CDEMO-PGM-ENTER   TO TRUE\nMOVE LIT-THISMAPSET    TO CDEMO-LAST-MAPSET\nMOVE LIT-THISMAP       TO CDEMO-LAST-MAP\nMOVE LIT-CARDUPDPGM    TO CCARD-NEXT-PROG\n\nMOVE LIT-CARDUPDMAPSET TO CCARD-NEXT-MAPSET\nMOVE LIT-CARDUPDMAP    TO CCARD-NEXT-MAP\n\nMOVE WS-ROW-ACCTNO (I-SELECTED)\nTO CDEMO-ACCT-ID\nMOVE WS-ROW-CARD-NUM (I-SELECTED)\nTO CDEMO-CARD-NUM\n\n*            CALL CARD UPDATE PROGRAM\n*\nEXEC CICS XCTL\nPROGRAM (CCARD-NEXT-PROG)\nCOMMAREA(CARDDEMO-COMMAREA)\nEND-EXEC\n\n*****************************************************************\nWHEN OTHER\n*****************************************************************\nMOVE WS-CA-FIRST-CARD-NUM\nTO WS-CARD-RID-CARDNUM\n*             MOVE WS-CA-FIRST-CARD-ACCT-ID\n*                           TO WS-CARD-RID-ACCT-ID\nPERFORM 9000-READ-FORWARD\nTHRU 9000-READ-FORWARD-EXIT\nPERFORM 1000-SEND-MAP\nTHRU 1000-SEND-MAP\nGO TO COMMON-RETURN\nEND-EVALUATE\n\n* If we had an error setup error message to display and return\nIF INPUT-ERROR\nMOVE WS-ERROR-MSG   TO CCARD-ERROR-MSG\nMOVE LIT-THISPGM     TO CDEMO-FROM-PROGRAM\nMOVE LIT-THISMAPSET  TO CDEMO-LAST-MAPSET\nMOVE LIT-THISMAP     TO CDEMO-LAST-MAP\n\nMOVE LIT-THISPGM     TO CCARD-NEXT-PROG\nMOVE LIT-THISMAPSET  TO CCARD-NEXT-MAPSET\nMOVE LIT-THISMAP     TO CCARD-NEXT-MAP\n*       PERFORM 1000-SEND-MAP\n*          THRU 1000-SEND-MAP\nGO TO COMMON-RETURN\nEND-IF\n\nMOVE LIT-THISPGM        TO CCARD-NEXT-PROG\nGO TO COMMON-RETURN\n.",
          "children": [
            {
              "name": "YYYY-STORE-PFKEY",
              "text": "PERFORM YYYY-STORE-PFKEY",
              "children": []
            },
            {
              "name": "2000-RECEIVE-MAP",
              "text": "PERFORM 2000-RECEIVE-MAP",
              "children": []
            },
            {
              "name": "9000-READ-FORWARD",
              "text": "PERFORM 9000-READ-FORWARD",
              "children": []
            },
            {
              "name": "1000-SEND-MAP",
              "text": "PERFORM 1000-SEND-MAP",
              "children": []
            },
            {
              "name": "9000-READ-FORWARD",
              "text": "PERFORM 9000-READ-FORWARD",
              "children": []
            },
            {
              "name": "1000-SEND-MAP",
              "text": "PERFORM 1000-SEND-MAP",
              "children": []
            },
            {
              "name": "9000-READ-FORWARD",
              "text": "PERFORM 9000-READ-FORWARD",
              "children": []
            },
            {
              "name": "1000-SEND-MAP",
              "text": "PERFORM 1000-SEND-MAP",
              "children": []
            },
            {
              "name": "9000-READ-FORWARD",
              "text": "PERFORM 9000-READ-FORWARD",
              "children": []
            },
            {
              "name": "1000-SEND-MAP",
              "text": "PERFORM 1000-SEND-MAP",
              "children": []
            },
            {
              "name": "9100-READ-BACKWARDS",
              "text": "PERFORM 9100-READ-BACKWARDS",
              "children": []
            },
            {
              "name": "1000-SEND-MAP",
              "text": "PERFORM 1000-SEND-MAP",
              "children": []
            },
            {
              "name": "9000-READ-FORWARD",
              "text": "PERFORM 9000-READ-FORWARD",
              "children": []
            },
            {
              "name": "1000-SEND-MAP",
              "text": "PERFORM 1000-SEND-MAP",
              "children": []
            },
            {
              "name": "1000-SEND-MAP",
              "text": "*       PERFORM 1000-SEND-MAP",
              "children": []
            }
          ]
        },
        {
          "name": "COMMON-RETURN",
          "text": "MOVE  LIT-THISTRANID TO CDEMO-FROM-TRANID\nMOVE  LIT-THISPGM     TO CDEMO-FROM-PROGRAM\nMOVE  LIT-THISMAPSET  TO CDEMO-LAST-MAPSET\nMOVE  LIT-THISMAP     TO CDEMO-LAST-MAP\nMOVE  CARDDEMO-COMMAREA    TO WS-COMMAREA\nMOVE  WS-THIS-PROGCOMMAREA TO\nWS-COMMAREA(LENGTH OF CARDDEMO-COMMAREA + 1:\nLENGTH OF WS-THIS-PROGCOMMAREA )\n\n\nEXEC CICS RETURN\nTRANSID (LIT-THISTRANID)\nCOMMAREA (WS-COMMAREA)\nLENGTH(LENGTH OF WS-COMMAREA)\nEND-EXEC\n.",
          "children": []
        },
        {
          "name": "0000-MAIN-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "1000-SEND-MAP",
          "text": "PERFORM 1100-SCREEN-INIT\nTHRU 1100-SCREEN-INIT-EXIT\nPERFORM 1200-SCREEN-ARRAY-INIT\nTHRU 1200-SCREEN-ARRAY-INIT-EXIT\nPERFORM 1250-SETUP-ARRAY-ATTRIBS\nTHRU 1250-SETUP-ARRAY-ATTRIBS-EXIT\nPERFORM 1300-SETUP-SCREEN-ATTRS\nTHRU 1300-SETUP-SCREEN-ATTRS-EXIT\nPERFORM 1400-SETUP-MESSAGE\nTHRU 1400-SETUP-MESSAGE-EXIT\nPERFORM 1500-SEND-SCREEN\nTHRU 1500-SEND-SCREEN-EXIT\n.",
          "children": [
            {
              "name": "1100-SCREEN-INIT",
              "text": "PERFORM 1100-SCREEN-INIT",
              "children": []
            },
            {
              "name": "1200-SCREEN-ARRAY-INIT",
              "text": "PERFORM 1200-SCREEN-ARRAY-INIT",
              "children": []
            },
            {
              "name": "1250-SETUP-ARRAY-ATTRIBS",
              "text": "PERFORM 1250-SETUP-ARRAY-ATTRIBS",
              "children": []
            },
            {
              "name": "1300-SETUP-SCREEN-ATTRS",
              "text": "PERFORM 1300-SETUP-SCREEN-ATTRS",
              "children": []
            },
            {
              "name": "1400-SETUP-MESSAGE",
              "text": "PERFORM 1400-SETUP-MESSAGE",
              "children": []
            },
            {
              "name": "1500-SEND-SCREEN",
              "text": "PERFORM 1500-SEND-SCREEN",
              "children": []
            }
          ]
        },
        {
          "name": "1000-SEND-MAP-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "1100-SCREEN-INIT",
          "text": "MOVE LOW-VALUES             TO CCRDLIAO\n\nMOVE FUNCTION CURRENT-DATE  TO WS-CURDATE-DATA\n\nMOVE CCDA-TITLE01           TO TITLE01O OF CCRDLIAO\nMOVE CCDA-TITLE02           TO TITLE02O OF CCRDLIAO\nMOVE LIT-THISTRANID         TO TRNNAMEO OF CCRDLIAO\nMOVE LIT-THISPGM            TO PGMNAMEO OF CCRDLIAO\n\nMOVE FUNCTION CURRENT-DATE  TO WS-CURDATE-DATA\n\nMOVE WS-CURDATE-MONTH       TO WS-CURDATE-MM\nMOVE WS-CURDATE-DAY         TO WS-CURDATE-DD\nMOVE WS-CURDATE-YEAR(3:2)   TO WS-CURDATE-YY\n\nMOVE WS-CURDATE-MM-DD-YY    TO CURDATEO OF CCRDLIAO\n\nMOVE WS-CURTIME-HOURS       TO WS-CURTIME-HH\nMOVE WS-CURTIME-MINUTE      TO WS-CURTIME-MM\nMOVE WS-CURTIME-SECOND      TO WS-CURTIME-SS\n\nMOVE WS-CURTIME-HH-MM-SS    TO CURTIMEO OF CCRDLIAO\n*    PAGE NUMBER\n*\nMOVE WS-CA-SCREEN-NUM       TO PAGENOO  OF CCRDLIAO\n\nSET WS-NO-INFO-MESSAGE      TO TRUE\nMOVE WS-INFO-MSG            TO INFOMSGO OF CCRDLIAO\nMOVE DFHBMDAR               TO INFOMSGC OF CCRDLIAO\n.",
          "children": []
        },
        {
          "name": "1100-SCREEN-INIT-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "1200-SCREEN-ARRAY-INIT",
          "text": "*    USE REDEFINES AND CLEAN UP REPETITIVE CODE !!\nIF   WS-EACH-CARD(1)            EQUAL LOW-VALUES\nCONTINUE\nELSE\nMOVE WS-EDIT-SELECT(1)       TO CRDSEL1O OF CCRDLIAO\nMOVE WS-ROW-ACCTNO(1)        TO ACCTNO1O OF CCRDLIAO\nMOVE WS-ROW-CARD-NUM(1)      TO CRDNUM1O OF CCRDLIAO\nMOVE WS-ROW-CARD-STATUS(1)   TO CRDSTS1O OF CCRDLIAO\nEND-IF\n\nIF   WS-EACH-CARD(2)        EQUAL LOW-VALUES\nCONTINUE\nELSE\nMOVE WS-EDIT-SELECT(2)       TO CRDSEL2O OF CCRDLIAO\nMOVE WS-ROW-ACCTNO(2)        TO ACCTNO2O OF CCRDLIAO\nMOVE WS-ROW-CARD-NUM(2)      TO CRDNUM2O OF CCRDLIAO\nMOVE WS-ROW-CARD-STATUS(2)   TO CRDSTS2O OF CCRDLIAO\nEND-IF\n\nIF   WS-EACH-CARD(3)        EQUAL LOW-VALUES\nCONTINUE\nELSE\nMOVE WS-EDIT-SELECT(3)       TO CRDSEL3O OF CCRDLIAO\nMOVE WS-ROW-ACCTNO(3)        TO ACCTNO3O OF CCRDLIAO\nMOVE WS-ROW-CARD-NUM(3)      TO CRDNUM3O OF CCRDLIAO\nMOVE WS-ROW-CARD-STATUS(3)   TO CRDSTS3O OF CCRDLIAO\nEND-IF\n\nIF   WS-EACH-CARD(4)        EQUAL LOW-VALUES\nCONTINUE\nELSE\nMOVE WS-EDIT-SELECT(4)       TO CRDSEL4O OF CCRDLIAO\nMOVE WS-ROW-ACCTNO(4)        TO ACCTNO4O OF CCRDLIAO\nMOVE WS-ROW-CARD-NUM(4)      TO CRDNUM4O OF CCRDLIAO\nMOVE WS-ROW-CARD-STATUS(4)   TO CRDSTS4O OF CCRDLIAO\nEND-IF\n\nIF   WS-EACH-CARD(5)        EQUAL LOW-VALUES\nCONTINUE\nELSE\nMOVE WS-EDIT-SELECT(5)       TO CRDSEL5O OF CCRDLIAO\nMOVE WS-ROW-ACCTNO(5)        TO ACCTNO5O OF CCRDLIAO\nMOVE WS-ROW-CARD-NUM(5)      TO CRDNUM5O OF CCRDLIAO\nMOVE WS-ROW-CARD-STATUS(5)   TO CRDSTS5O OF CCRDLIAO\nEND-IF\n\n\nIF   WS-EACH-CARD(6)        EQUAL LOW-VALUES\nCONTINUE\nELSE\nMOVE WS-EDIT-SELECT(6)       TO CRDSEL6O OF CCRDLIAO\nMOVE WS-ROW-ACCTNO(6)        TO ACCTNO6O OF CCRDLIAO\nMOVE WS-ROW-CARD-NUM(6)      TO CRDNUM6O OF CCRDLIAO\nMOVE WS-ROW-CARD-STATUS(6)   TO CRDSTS6O OF CCRDLIAO\nEND-IF\n\nIF   WS-EACH-CARD(7)        EQUAL LOW-VALUES\nCONTINUE\nELSE\nMOVE WS-EDIT-SELECT(7)       TO CRDSEL7O OF CCRDLIAO\nMOVE WS-ROW-ACCTNO(7)        TO ACCTNO7O OF CCRDLIAO\nMOVE WS-ROW-CARD-NUM(7)      TO CRDNUM7O OF CCRDLIAO\nMOVE WS-ROW-CARD-STATUS(7)   TO CRDSTS7O OF CCRDLIAO\nEND-IF\n.",
          "children": []
        },
        {
          "name": "1200-SCREEN-ARRAY-INIT-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "1250-SETUP-ARRAY-ATTRIBS",
          "text": "*    USE REDEFINES AND CLEAN UP REPETITIVE CODE !!\n\nIF   WS-EACH-CARD(1)            EQUAL LOW-VALUES\nOR   FLG-PROTECT-SELECT-ROWS-YES\nMOVE DFHBMPRF                TO CRDSEL1A OF CCRDLIAI\nELSE\nIF WS-ROW-CRDSELECT-ERROR(1) = '1'\nMOVE DFHRED               TO CRDSEL1C OF CCRDLIAO\nIF WS-EDIT-SELECT(1) = SPACE OR LOW-VALUES\nMOVE '*'               TO CRDSEL1O OF CCRDLIAO\nEND-IF\nEND-IF\nMOVE DFHBMFSE                TO CRDSEL1A OF CCRDLIAI\nEND-IF\n\nIF   WS-EACH-CARD(2)            EQUAL LOW-VALUES\nOR   FLG-PROTECT-SELECT-ROWS-YES\nMOVE DFHBMPRO                TO CRDSEL2A OF CCRDLIAI\nELSE\nIF WS-ROW-CRDSELECT-ERROR(2) = '1'\nMOVE DFHRED               TO CRDSEL2C OF CCRDLIAO\nMOVE -1                   TO CRDSEL2L OF CCRDLIAI\nEND-IF\nMOVE DFHBMFSE                TO CRDSEL2A OF CCRDLIAI\nEND-IF\n\nIF   WS-EACH-CARD(3)            EQUAL LOW-VALUES\nOR   FLG-PROTECT-SELECT-ROWS-YES\nMOVE DFHBMPRO                TO CRDSEL3A OF CCRDLIAI\n\nELSE\nIF WS-ROW-CRDSELECT-ERROR(3) = '1'\nMOVE DFHRED               TO CRDSEL3C OF CCRDLIAO\nMOVE -1                   TO CRDSEL3L OF CCRDLIAI\nEND-IF\nMOVE DFHBMFSE                TO CRDSEL3A OF CCRDLIAI\nEND-IF\n\nIF   WS-EACH-CARD(4)            EQUAL LOW-VALUES\nOR   FLG-PROTECT-SELECT-ROWS-YES\nMOVE DFHBMPRO                TO CRDSEL4A OF CCRDLIAI\nI\nELSE\nIF WS-ROW-CRDSELECT-ERROR(4) = '1'\nMOVE DFHRED               TO CRDSEL4C OF CCRDLIAO\nMOVE -1                   TO CRDSEL4L OF CCRDLIAI\nEND-IF\nMOVE DFHBMFSE                TO CRDSEL4A OF CCRDLIAI\nEND-IF\n\nIF   WS-EACH-CARD(5)            EQUAL LOW-VALUES\nOR   FLG-PROTECT-SELECT-ROWS-YES\nMOVE DFHBMPRO                TO CRDSEL5A OF CCRDLIAI\nELSE\nIF WS-ROW-CRDSELECT-ERROR(5) = '1'\nMOVE DFHRED               TO CRDSEL5C OF CCRDLIAO\nMOVE -1                   TO CRDSEL5L OF CCRDLIAI\nEND-IF\nMOVE DFHBMFSE                TO CRDSEL5A OF CCRDLIAI\nEND-IF\n\nIF   WS-EACH-CARD(6)            EQUAL LOW-VALUES\nOR   FLG-PROTECT-SELECT-ROWS-YES\nMOVE DFHBMPRO                TO CRDSEL6A OF CCRDLIAI\n\nELSE\nIF WS-ROW-CRDSELECT-ERROR(6) = '1'\nMOVE DFHRED               TO CRDSEL6C OF CCRDLIAO\nMOVE -1                   TO CRDSEL6L OF CCRDLIAI\nEND-IF\nMOVE DFHBMFSE                TO CRDSEL6A OF CCRDLIAI\nEND-IF\n\nIF   WS-EACH-CARD(7)            EQUAL LOW-VALUES\nOR   FLG-PROTECT-SELECT-ROWS-YES\nMOVE DFHBMPRO                TO CRDSEL7A OF CCRDLIAI\nELSE\nIF WS-ROW-CRDSELECT-ERROR(7) = '1'\nMOVE DFHRED               TO CRDSEL7C OF CCRDLIAO\nMOVE -1                   TO CRDSEL7L OF CCRDLIAI\nEND-IF\nMOVE DFHBMFSE                TO CRDSEL7A OF CCRDLIAI\nEND-IF\n.",
          "children": []
        },
        {
          "name": "1250-SETUP-ARRAY-ATTRIBS-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "1300-SETUP-SCREEN-ATTRS",
          "text": "*    INITIALIZE SEARCH CRITERIA\nIF EIBCALEN = 0\nOR (CDEMO-PGM-ENTER\nAND CDEMO-FROM-PROGRAM = LIT-MENUPGM)\nCONTINUE\nELSE\nEVALUATE TRUE\nWHEN FLG-ACCTFILTER-ISVALID\nWHEN FLG-ACCTFILTER-NOT-OK\nMOVE CC-ACCT-ID   TO ACCTSIDO OF CCRDLIAO\nMOVE DFHBMFSE     TO ACCTSIDA OF CCRDLIAI\nWHEN CDEMO-ACCT-ID = 0\nMOVE LOW-VALUES   TO ACCTSIDO OF CCRDLIAO\nWHEN OTHER\nMOVE CDEMO-ACCT-ID TO ACCTSIDO OF CCRDLIAO\nMOVE DFHBMFSE      TO ACCTSIDA OF CCRDLIAI\nEND-EVALUATE\n\nEVALUATE TRUE\nWHEN FLG-CARDFILTER-ISVALID\nWHEN FLG-CARDFILTER-NOT-OK\nMOVE CC-CARD-NUM  TO CARDSIDO OF CCRDLIAO\nMOVE DFHBMFSE     TO CARDSIDA OF CCRDLIAI\nWHEN CDEMO-CARD-NUM = 0\nMOVE LOW-VALUES   TO CARDSIDO OF CCRDLIAO\nWHEN OTHER\nMOVE CDEMO-CARD-NUM\nTO CARDSIDO OF CCRDLIAO\nMOVE DFHBMFSE      TO CARDSIDA OF CCRDLIAI\nEND-EVALUATE\nEND-IF\n\n*    POSITION CURSOR\n\nIF FLG-ACCTFILTER-NOT-OK\nMOVE  DFHRED             TO ACCTSIDC OF CCRDLIAO\nMOVE  -1                 TO ACCTSIDL OF CCRDLIAI\nEND-IF\n\nIF FLG-CARDFILTER-NOT-OK\nMOVE  DFHRED             TO CARDSIDC OF CCRDLIAO\nMOVE  -1                 TO CARDSIDL OF CCRDLIAI\nEND-IF\n\n*    IF NO ERRORS POSITION CURSOR AT ACCTID\n\nIF INPUT-OK\nMOVE   -1                 TO ACCTSIDL OF CCRDLIAI\nEND-IF\n\n\n.",
          "children": []
        },
        {
          "name": "1300-SETUP-SCREEN-ATTRS-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "1400-SETUP-MESSAGE",
          "text": "*    SETUP MESSAGE\nEVALUATE TRUE\nWHEN FLG-ACCTFILTER-NOT-OK\nWHEN FLG-CARDFILTER-NOT-OK\nCONTINUE\nWHEN CCARD-AID-PFK07\nAND CA-FIRST-PAGE\nMOVE 'NO PREVIOUS PAGES TO DISPLAY'\nTO WS-ERROR-MSG\nWHEN CCARD-AID-PFK08\nAND CA-NEXT-PAGE-NOT-EXISTS\nAND CA-LAST-PAGE-SHOWN\nMOVE 'NO MORE PAGES TO DISPLAY'\nTO WS-ERROR-MSG\nWHEN CCARD-AID-PFK08\nAND CA-NEXT-PAGE-NOT-EXISTS\nSET WS-INFORM-REC-ACTIONS TO TRUE\nIF  CA-LAST-PAGE-NOT-SHOWN\nAND CA-NEXT-PAGE-NOT-EXISTS\nSET CA-LAST-PAGE-SHOWN TO TRUE\nEND-IF\nWHEN WS-NO-INFO-MESSAGE\nWHEN CA-NEXT-PAGE-EXISTS\nSET WS-INFORM-REC-ACTIONS TO TRUE\nWHEN OTHER\nSET WS-NO-INFO-MESSAGE TO TRUE\nEND-EVALUATE\n\nMOVE WS-ERROR-MSG          TO ERRMSGO OF CCRDLIAO\n\nIF  NOT WS-NO-INFO-MESSAGE\nAND NOT WS-NO-RECORDS-FOUND\nMOVE WS-INFO-MSG        TO INFOMSGO OF CCRDLIAO\nMOVE DFHNEUTR           TO INFOMSGC OF CCRDLIAO\nEND-IF\n\n.",
          "children": []
        },
        {
          "name": "1400-SETUP-MESSAGE-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "1500-SEND-SCREEN",
          "text": "EXEC CICS SEND MAP(LIT-THISMAP)\nMAPSET(LIT-THISMAPSET)\nFROM(CCRDLIAO)\nCURSOR\nERASE\nRESP(WS-RESP-CD)\nFREEKB\nEND-EXEC\n.",
          "children": []
        },
        {
          "name": "1500-SEND-SCREEN-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "2000-RECEIVE-MAP",
          "text": "PERFORM 2100-RECEIVE-SCREEN\nTHRU 2100-RECEIVE-SCREEN-EXIT\n\nPERFORM 2200-EDIT-INPUTS\nTHRU   2200-EDIT-INPUTS-EXIT\n.",
          "children": [
            {
              "name": "2100-RECEIVE-SCREEN",
              "text": "PERFORM 2100-RECEIVE-SCREEN",
              "children": []
            },
            {
              "name": "2200-EDIT-INPUTS",
              "text": "PERFORM 2200-EDIT-INPUTS",
              "children": []
            }
          ]
        },
        {
          "name": "2000-RECEIVE-MAP-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "2100-RECEIVE-SCREEN",
          "text": "EXEC CICS RECEIVE MAP(LIT-THISMAP)\nMAPSET(LIT-THISMAPSET)\nINTO(CCRDLIAI)\nRESP(WS-RESP-CD)\nEND-EXEC\n\nMOVE ACCTSIDI OF CCRDLIAI  TO CC-ACCT-ID\nMOVE CARDSIDI OF CCRDLIAI  TO CC-CARD-NUM\n\nMOVE CRDSEL1I OF CCRDLIAI  TO WS-EDIT-SELECT(1)\nMOVE CRDSEL2I OF CCRDLIAI  TO WS-EDIT-SELECT(2)\nMOVE CRDSEL3I OF CCRDLIAI  TO WS-EDIT-SELECT(3)\nMOVE CRDSEL4I OF CCRDLIAI  TO WS-EDIT-SELECT(4)\nMOVE CRDSEL5I OF CCRDLIAI  TO WS-EDIT-SELECT(5)\nMOVE CRDSEL6I OF CCRDLIAI  TO WS-EDIT-SELECT(6)\nMOVE CRDSEL7I OF CCRDLIAI  TO WS-EDIT-SELECT(7)\n.",
          "children": []
        },
        {
          "name": "2100-RECEIVE-SCREEN-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "2200-EDIT-INPUTS",
          "text": "SET INPUT-OK                   TO TRUE\nSET FLG-PROTECT-SELECT-ROWS-NO TO TRUE\n\nPERFORM 2210-EDIT-ACCOUNT\nTHRU 2210-EDIT-ACCOUNT-EXIT\n\nPERFORM 2220-EDIT-CARD\nTHRU 2220-EDIT-CARD-EXIT\n\nPERFORM 2250-EDIT-ARRAY\nTHRU 2250-EDIT-ARRAY-EXIT\n.",
          "children": [
            {
              "name": "2210-EDIT-ACCOUNT",
              "text": "PERFORM 2210-EDIT-ACCOUNT",
              "children": []
            },
            {
              "name": "2220-EDIT-CARD",
              "text": "PERFORM 2220-EDIT-CARD",
              "children": []
            },
            {
              "name": "2250-EDIT-ARRAY",
              "text": "PERFORM 2250-EDIT-ARRAY",
              "children": []
            }
          ]
        },
        {
          "name": "2200-EDIT-INPUTS-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "2210-EDIT-ACCOUNT",
          "text": "SET FLG-ACCTFILTER-BLANK TO TRUE\n\n*    Not supplied\nIF CC-ACCT-ID   EQUAL LOW-VALUES\nOR CC-ACCT-ID   EQUAL SPACES\nOR CC-ACCT-ID-N EQUAL ZEROS\nSET FLG-ACCTFILTER-BLANK  TO TRUE\nMOVE ZEROES       TO CDEMO-ACCT-ID\nGO TO  2210-EDIT-ACCOUNT-EXIT\nEND-IF\n*\n*    Not numeric\n*    Not 11 characters\nIF CC-ACCT-ID  IS NOT NUMERIC\nSET INPUT-ERROR TO TRUE\nSET FLG-ACCTFILTER-NOT-OK TO TRUE\nSET FLG-PROTECT-SELECT-ROWS-YES TO TRUE\nMOVE\n'ACCOUNT FILTER,IF SUPPLIED MUST BE A 11 DIGIT NUMBER'\nTO WS-ERROR-MSG\nMOVE ZERO       TO CDEMO-ACCT-ID\nGO TO 2210-EDIT-ACCOUNT-EXIT\nELSE\nMOVE CC-ACCT-ID TO CDEMO-ACCT-ID\nSET FLG-ACCTFILTER-ISVALID TO TRUE\nEND-IF\n.",
          "children": []
        },
        {
          "name": "2210-EDIT-ACCOUNT-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "2220-EDIT-CARD",
          "text": "*    Not numeric\n*    Not 16 characters\nSET FLG-CARDFILTER-BLANK TO TRUE\n\n*    Not supplied\nIF CC-CARD-NUM   EQUAL LOW-VALUES\nOR CC-CARD-NUM   EQUAL SPACES\nOR CC-CARD-NUM-N EQUAL ZEROS\nSET FLG-CARDFILTER-BLANK  TO TRUE\nMOVE ZEROES       TO CDEMO-CARD-NUM\nGO TO  2220-EDIT-CARD-EXIT\nEND-IF\n*\n*    Not numeric\n*    Not 16 characters\nIF CC-CARD-NUM  IS NOT NUMERIC\nSET INPUT-ERROR TO TRUE\nSET FLG-CARDFILTER-NOT-OK TO TRUE\nSET FLG-PROTECT-SELECT-ROWS-YES TO TRUE\nIF WS-ERROR-MSG-OFF\nMOVE\n'CARD ID FILTER,IF SUPPLIED MUST BE A 16 DIGIT NUMBER'\nTO WS-ERROR-MSG\nEND-IF\nMOVE ZERO       TO CDEMO-CARD-NUM\nGO TO 2220-EDIT-CARD-EXIT\nELSE\nMOVE CC-CARD-NUM-N TO CDEMO-CARD-NUM\nSET FLG-CARDFILTER-ISVALID TO TRUE\nEND-IF\n.",
          "children": []
        },
        {
          "name": "2220-EDIT-CARD-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "2250-EDIT-ARRAY",
          "text": "IF INPUT-ERROR\nGO TO 2250-EDIT-ARRAY-EXIT\nEND-IF\n\nINSPECT  WS-EDIT-SELECT-FLAGS\nTALLYING I\nFOR ALL 'S'\nALL 'U'\n\nIF I > +1\nSET INPUT-ERROR      TO TRUE\nSET WS-MORE-THAN-1-ACTION TO TRUE\n\nMOVE WS-EDIT-SELECT-FLAGS\nTO WS-EDIT-SELECT-ERROR-FLAGS\nINSPECT WS-EDIT-SELECT-ERROR-FLAGS\nREPLACING ALL 'S' BY '1'\nALL 'U' BY '1'\nCHARACTERS        BY '0'\n\nEND-IF\n\nMOVE ZERO TO I-SELECTED\n\nPERFORM VARYING I FROM 1 BY 1 UNTIL I > 7\nEVALUATE TRUE\nWHEN SELECT-OK(I)\nMOVE I TO I-SELECTED\nIF WS-MORE-THAN-1-ACTION\nMOVE '1' TO WS-ROW-CRDSELECT-ERROR(I)\nEND-IF\nWHEN SELECT-BLANK(I)\nCONTINUE\nWHEN OTHER\nSET INPUT-ERROR TO TRUE\nMOVE '1' TO WS-ROW-CRDSELECT-ERROR(I)\nIF WS-ERROR-MSG-OFF\nSET WS-INVALID-ACTION-CODE TO TRUE\nEND-IF\nEND-EVALUATE\nEND-PERFORM\n\n.",
          "children": [
            {
              "name": "VARYING",
              "text": "PERFORM VARYING I FROM 1 BY 1 UNTIL I > 7",
              "children": []
            }
          ]
        },
        {
          "name": "2250-EDIT-ARRAY-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "9000-READ-FORWARD",
          "text": "MOVE LOW-VALUES           TO WS-ALL-ROWS\n\n*****************************************************************\n*    Start Browse\n*****************************************************************\nEXEC CICS STARTBR\nDATASET(LIT-CARD-FILE)\nRIDFLD(WS-CARD-RID-CARDNUM)\nKEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)\nGTEQ\nRESP(WS-RESP-CD)\nRESP2(WS-REAS-CD)\nEND-EXEC\n*****************************************************************\n*    Loop through records and fetch max screen records\n*****************************************************************\nMOVE ZEROES TO WS-SCRN-COUNTER\nSET CA-NEXT-PAGE-EXISTS    TO TRUE\nSET MORE-RECORDS-TO-READ   TO TRUE\n\nPERFORM UNTIL READ-LOOP-EXIT\n\nEXEC CICS READNEXT\nDATASET(LIT-CARD-FILE)\nINTO (CARD-RECORD)\nLENGTH(LENGTH OF CARD-RECORD)\nRIDFLD(WS-CARD-RID-CARDNUM)\nKEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)\nRESP(WS-RESP-CD)\nRESP2(WS-REAS-CD)\nEND-EXEC\n\nEVALUATE WS-RESP-CD\nWHEN DFHRESP(NORMAL)\nWHEN DFHRESP(DUPREC)\nPERFORM 9500-FILTER-RECORDS\nTHRU 9500-FILTER-RECORDS-EXIT\n\nIF WS-DONOT-EXCLUDE-THIS-RECORD\nADD 1             TO WS-SCRN-COUNTER\n\nMOVE CARD-NUM     TO WS-ROW-CARD-NUM(\nWS-SCRN-COUNTER)\nMOVE CARD-ACCT-ID TO\nWS-ROW-ACCTNO(WS-SCRN-COUNTER)\nMOVE CARD-ACTIVE-STATUS\nTO WS-ROW-CARD-STATUS(\nWS-SCRN-COUNTER)\n\nIF WS-SCRN-COUNTER = 1\nMOVE CARD-ACCT-ID\nTO WS-CA-FIRST-CARD-ACCT-ID\nMOVE CARD-NUM  TO WS-CA-FIRST-CARD-NUM\nIF   WS-CA-SCREEN-NUM = 0\nADD   +1     TO WS-CA-SCREEN-NUM\nELSE\nCONTINUE\nEND-IF\nELSE\nCONTINUE\nEND-IF\nELSE\nCONTINUE\nEND-IF\n******************************************************************\n*            Max Screen size\n******************************************************************\nIF WS-SCRN-COUNTER = WS-MAX-SCREEN-LINES\nSET READ-LOOP-EXIT  TO TRUE\n\nMOVE CARD-ACCT-ID     TO WS-CA-LAST-CARD-ACCT-ID\nMOVE CARD-NUM         TO WS-CA-LAST-CARD-NUM\n\nEXEC CICS READNEXT\nDATASET(LIT-CARD-FILE)\nINTO (CARD-RECORD)\nLENGTH(LENGTH OF CARD-RECORD)\nRIDFLD(WS-CARD-RID-CARDNUM)\nKEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)\nRESP(WS-RESP-CD)\nRESP2(WS-REAS-CD)\nEND-EXEC\n\nEVALUATE WS-RESP-CD\nWHEN DFHRESP(NORMAL)\nWHEN DFHRESP(DUPREC)\nSET CA-NEXT-PAGE-EXISTS\nTO TRUE\nMOVE CARD-ACCT-ID TO\nWS-CA-LAST-CARD-ACCT-ID\nMOVE CARD-NUM     TO WS-CA-LAST-CARD-NUM\nWHEN DFHRESP(ENDFILE)\nSET CA-NEXT-PAGE-NOT-EXISTS     TO TRUE\n\nIF WS-ERROR-MSG-OFF\nMOVE 'NO MORE RECORDS TO SHOW'\nTO WS-ERROR-MSG\nEND-IF\nWHEN OTHER\n*                     This is some kind of error. Change to END BR\n*                     And exit\nSET READ-LOOP-EXIT      TO TRUE\nMOVE 'READ'              TO ERROR-OPNAME\nMOVE LIT-CARD-FILE       TO ERROR-FILE\nMOVE WS-RESP-CD          TO ERROR-RESP\nMOVE WS-REAS-CD          TO ERROR-RESP2\nMOVE WS-FILE-ERROR-MESSAGE TO WS-ERROR-MSG\nEND-EVALUATE\nEND-IF\nWHEN DFHRESP(ENDFILE)\nSET READ-LOOP-EXIT              TO TRUE\nSET CA-NEXT-PAGE-NOT-EXISTS     TO TRUE\nMOVE CARD-ACCT-ID     TO WS-CA-LAST-CARD-ACCT-ID\nMOVE CARD-NUM         TO WS-CA-LAST-CARD-NUM\nIF WS-ERROR-MSG-OFF\nMOVE 'NO MORE RECORDS TO SHOW'  TO WS-ERROR-MSG\nEND-IF\nIF WS-CA-SCREEN-NUM = 1\nAND WS-SCRN-COUNTER = 0\n*               MOVE 'NO RECORDS TO SHOW'  TO WS-ERROR-MSG\nSET WS-NO-RECORDS-FOUND    TO TRUE\nEND-IF\nWHEN OTHER\n*           This is some kind of error. Change to END BR\n*           And exit\nSET READ-LOOP-EXIT             TO TRUE\nMOVE 'READ'                     TO ERROR-OPNAME\nMOVE LIT-CARD-FILE              TO ERROR-FILE\nMOVE WS-RESP-CD                 TO ERROR-RESP\nMOVE WS-REAS-CD                 TO ERROR-RESP2\nMOVE WS-FILE-ERROR-MESSAGE      TO WS-ERROR-MSG\nEND-EVALUATE\nEND-PERFORM\n\nEXEC CICS ENDBR FILE(LIT-CARD-FILE)\nEND-EXEC\n.",
          "children": [
            {
              "name": "UNTIL",
              "text": "PERFORM UNTIL READ-LOOP-EXIT",
              "children": []
            },
            {
              "name": "9500-FILTER-RECORDS",
              "text": "PERFORM 9500-FILTER-RECORDS",
              "children": []
            }
          ]
        },
        {
          "name": "9000-READ-FORWARD-EXIT",
          "text": "EXIT\n.",
          "children": []
        },
        {
          "name": "9100-READ-BACKWARDS",
          "text": "MOVE LOW-VALUES           TO WS-ALL-ROWS\n\nMOVE WS-CA-FIRST-CARDKEY  TO WS-CA-LAST-CARDKEY\n\n*****************************************************************\n*    Start Browse\n*****************************************************************\nEXEC CICS STARTBR\nDATASET(LIT-CARD-FILE)\nRIDFLD(WS-CARD-RID-CARDNUM)\nKEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)\nGTEQ\nRESP(WS-RESP-CD)\nRESP2(WS-REAS-CD)\nEND-EXEC\n*****************************************************************\n*    Loop through records and fetch max screen records\n*****************************************************************\nCOMPUTE WS-SCRN-COUNTER =\nWS-MAX-SCREEN-LINES + 1\nEND-COMPUTE\nSET CA-NEXT-PAGE-EXISTS    TO TRUE\nSET MORE-RECORDS-TO-READ   TO TRUE\n\n*****************************************************************\n*    Now we show the records from previous set.\n*****************************************************************\n\nEXEC CICS READPREV\nDATASET(LIT-CARD-FILE)\nINTO (CARD-RECORD)\nLENGTH(LENGTH OF CARD-RECORD)\nRIDFLD(WS-CARD-RID-CARDNUM)\nKEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)\nRESP(WS-RESP-CD)\nRESP2(WS-REAS-CD)\nEND-EXEC\n\nEVALUATE WS-RESP-CD\nWHEN DFHRESP(NORMAL)\nWHEN DFHRESP(DUPREC)\nSUBTRACT 1          FROM WS-SCRN-COUNTER\nWHEN OTHER\n*           This is some kind of error. Change to END BR\n*           And exit\nSET READ-LOOP-EXIT             TO TRUE\nMOVE 'READ'                     TO ERROR-OPNAME\nMOVE LIT-CARD-FILE              TO ERROR-FILE\nMOVE WS-RESP-CD                 TO ERROR-RESP\nMOVE WS-REAS-CD                 TO ERROR-RESP2\nMOVE WS-FILE-ERROR-MESSAGE      TO WS-ERROR-MSG\nGO TO 9100-READ-BACKWARDS-EXIT\nEND-EVALUATE\n\nPERFORM UNTIL READ-LOOP-EXIT\n\nEXEC CICS READPREV\nDATASET(LIT-CARD-FILE)\nINTO (CARD-RECORD)\nLENGTH(LENGTH OF CARD-RECORD)\nRIDFLD(WS-CARD-RID-CARDNUM)\nKEYLENGTH(LENGTH OF WS-CARD-RID-CARDNUM)\nRESP(WS-RESP-CD)\nRESP2(WS-REAS-CD)\nEND-EXEC\n\nEVALUATE WS-RESP-CD\nWHEN DFHRESP(NORMAL)\nWHEN DFHRESP(DUPREC)\nPERFORM 9500-FILTER-RECORDS\nTHRU 9500-FILTER-RECORDS-EXIT\nIF WS-DONOT-EXCLUDE-THIS-RECORD\nMOVE CARD-NUM\nTO WS-ROW-CARD-NUM(WS-SCRN-COUNTER)\nMOVE CARD-ACCT-ID\nTO WS-ROW-ACCTNO(WS-SCRN-COUNTER)\nMOVE CARD-ACTIVE-STATUS\nTO\nWS-ROW-CARD-STATUS(WS-SCRN-COUNTER)\n\nSUBTRACT 1  FROM WS-SCRN-COUNTER\nIF WS-SCRN-COUNTER = 0\nSET READ-LOOP-EXIT  TO TRUE\n\nMOVE CARD-ACCT-ID\nTO WS-CA-FIRST-CARD-ACCT-ID\nMOVE CARD-NUM\nTO WS-CA-FIRST-CARD-NUM\nELSE\nCONTINUE\nEND-IF\nELSE\nCONTINUE\nEND-IF\n\nWHEN OTHER\n*           This is some kind of error. Change to END BR\n*           And exit\nSET READ-LOOP-EXIT             TO TRUE\nMOVE 'READ'                     TO ERROR-OPNAME\nMOVE LIT-CARD-FILE              TO ERROR-FILE\nMOVE WS-RESP-CD                 TO ERROR-RESP\nMOVE WS-REAS-CD                 TO ERROR-RESP2\nMOVE WS-FILE-ERROR-MESSAGE      TO WS-ERROR-MSG\nEND-EVALUATE\nEND-PERFORM\n.",
          "children": [
            {
              "name": "UNTIL",
              "text": "PERFORM UNTIL READ-LOOP-EXIT",
              "children": []
            },
            {
              "name": "9500-FILTER-RECORDS",
              "text": "PERFORM 9500-FILTER-RECORDS",
              "children": []
            }
          ]
        },
        {
          "name": "9100-READ-BACKWARDS-EXIT",
          "text": "EXEC CICS\nENDBR FILE(LIT-CARD-FILE)\nEND-EXEC\n\nEXIT\n.",
          "children": []
        },
        {
          "name": "9500-FILTER-RECORDS",
          "text": "SET WS-DONOT-EXCLUDE-THIS-RECORD TO TRUE\n\nIF FLG-ACCTFILTER-ISVALID\nIF  CARD-ACCT-ID = CC-ACCT-ID\nCONTINUE\nELSE\nSET WS-EXCLUDE-THIS-RECORD  TO TRUE\nGO TO 9500-FILTER-RECORDS-EXIT\nEND-IF\nELSE\nCONTINUE\nEND-IF\n\nIF FLG-CARDFILTER-ISVALID\nIF  CARD-NUM = CC-CARD-NUM-N\nCONTINUE\nELSE\nSET WS-EXCLUDE-THIS-RECORD TO TRUE\nGO TO 9500-FILTER-RECORDS-EXIT\nEND-IF\nELSE\nCONTINUE\nEND-IF\n\n.",
          "children": []
        },
        {
          "name": "9500-FILTER-RECORDS-EXIT",
          "text": "EXIT\n.\n\n*****************************************************************\n*Common code to store PFKey\n*****************************************************************\nCOPY 'CSSTRPFY'\n.\n\n*****************************************************************\n* Plain text exit - Dont use in production                      *\n*****************************************************************",
          "children": []
        },
        {
          "name": "SEND-PLAIN-TEXT",
          "text": "EXEC CICS SEND TEXT\nFROM(WS-ERROR-MSG)\nLENGTH(LENGTH OF WS-ERROR-MSG)\nERASE\nFREEKB\nEND-EXEC\n\nEXEC CICS RETURN\nEND-EXEC\n.",
          "children": []
        },
        {
          "name": "SEND-PLAIN-TEXT-EXIT",
          "text": "EXIT\n.\n*****************************************************************\n* Display Long text and exit                                    *\n* This is primarily for debugging and should not be used in     *\n* regular course                                                *\n*****************************************************************",
          "children": []
        },
        {
          "name": "SEND-LONG-TEXT",
          "text": "EXEC CICS SEND TEXT\nFROM(WS-LONG-MSG)\nLENGTH(LENGTH OF WS-LONG-MSG)\nERASE\nFREEKB\nEND-EXEC\n\nEXEC CICS RETURN\nEND-EXEC\n.",
          "children": []
        },
        {
          "name": "SEND-LONG-TEXT-EXIT",
          "text": "EXIT\n.\n\n\n*\n* Ver: CardDemo_v1.0-15-g27d6c6f-68 Date: 2022-07-19 23:12:33 CDT\n*",
          "children": []
        }
      ]
    }
  ]
};

        const width = window.innerWidth;
        const height = window.innerHeight;

        const svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .call(d3.zoom().on("zoom", (event) => {
                g.attr("transform", event.transform);
            }))
            .append("g");

        const defs = svg.append("defs");
        defs.append("marker")
            .attr("id", "arrow")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 10)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#d2b48c");

        const g = svg.append("g")
            .attr("transform", "translate(50, 50)");

        const tree = d3.tree().size([height - 200, width * 0.8 - 300]); // Reduce width by 20%

        const root = d3.hierarchy(data);

        root.descendants().forEach((d, i) => {
            d.id = i;
            d._children = d.children;
            d.children = d.depth < 3 ? d.children : null; // Keep top 3 levels expanded
        });

        const colorScale = d3.scaleSequential(d3.interpolateCool)
            .domain([0, 10]); // Adjust the domain as per depth levels

        const update = (source) => {
            const nodes = root.descendants();
            const links = root.links();

            tree(root);

            // Links
            const link = g.selectAll(".link")
                .data(links, d => d.target.id);

            link.enter().append("line")
                .attr("class", "link")
                .merge(link)
                .attr("x1", d => d.source.y)
                .attr("y1", d => d.source.x)
                .attr("x2", d => d.target.y)
                .attr("y2", d => d.target.x)
                .attr("stroke", "#d2b48c") // Light brown color
                .attr("stroke-width", 1.5); // Thin lines

            link.exit().remove();

            // Nodes
            const node = g.selectAll(".node")
                .data(nodes, d => d.id);

            const nodeEnter = node.enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${source.y0 || 0},${source.x0 || 0})`)
                .on("click", (event, d) => {
                    d.children = d.children ? null : d._children;
                    update(d);
                });

            nodeEnter.append("circle")
                .attr("r", 8)
                .attr("fill", d => colorScale(d.depth))
                .attr("stroke", d => (d._children ? "#000" : "#aaa")) // Black border for collapsible nodes
                .attr("stroke-width", d => (d._children ? 2 : 1)); // Thicker border for collapsible nodes

            nodeEnter.append("text")
                .attr("dy", 3)
                .attr("x", d => d.children || d._children ? -10 : 10)
                .style("text-anchor", d => d.children || d._children ? "end" : "start")
                .text(d => d.data.name);

            const nodeUpdate = nodeEnter.merge(node);

            nodeUpdate.transition()
                .duration(200)
                .attr("transform", d => `translate(${d.y},${d.x})`);

            nodes.forEach(d => {
                d.x0 = d.x;
                d.y0 = d.y;
            });

            node.exit().transition()
                .duration(200)
                .remove();
        };

        update(root);
    </script>
</body>
</html>
    